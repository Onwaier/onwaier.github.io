<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.10.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

  <meta name="description" content="Onwaier的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Onwaier&#39;s Blog">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Onwaier&#39;s Blog">
<meta property="og:description" content="Onwaier的个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Onwaier">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Onwaier's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Onwaier's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">大步后退亦或停止不前，不如匍匐前进</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Onwaier</p>
  <div class="site-description" itemprop="description">Onwaier的个人博客</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">70</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Onwaier" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Onwaier" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:onwaier@163.com" title="E-Mail → mailto:onwaier@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/01/%E6%91%A9%E5%B0%94%E6%8A%95%E7%A5%A8%E6%B3%95boyer-moore-majority-vote-algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/01/%E6%91%A9%E5%B0%94%E6%8A%95%E7%A5%A8%E6%B3%95boyer-moore-majority-vote-algorithm/" class="post-title-link" itemprop="url">摩尔投票法(Boyer–Moore majority vote algorithm)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-01 17:23:58" itemprop="dateCreated datePublished" datetime="2020-02-01T17:23:58+08:00">2020-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:00:14" itemprop="dateModified" datetime="2022-02-13T14:00:14+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
    </span>

  
    <span id="/2020/02/01/%E6%91%A9%E5%B0%94%E6%8A%95%E7%A5%A8%E6%B3%95boyer-moore-majority-vote-algorithm/" class="post-meta-item leancloud_visitors" data-flag-title="摩尔投票法(Boyer–Moore majority vote algorithm)" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/02/01/%E6%91%A9%E5%B0%94%E6%8A%95%E7%A5%A8%E6%B3%95boyer-moore-majority-vote-algorithm/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/02/01/摩尔投票法boyer-moore-majority-vote-algorithm/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.cs.ou.edu/~rlpage/dmtools/mjrty.pdf">论文MJRTY A Fast Majority Vote Algorithm</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cs.utexas.edu/~moore/best-ideas/mjrty/index.html">算法演示网站</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_majority_vote_algorithm">维基百科</a></li>
</ol>
<h2 id="算法解读"><a href="#算法解读" class="headerlink" title="算法解读"></a>算法解读</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p><img src="/images/2020/02/7c1a38379afd4d065b99dba5c9db906d.png" alt=""></p>
</blockquote>
<p>摩尔投票法(Boyer–Moore majority vote algorithm)出自<a target="_blank" rel="noopener" href="https://www.cs.ou.edu/~rlpage/dmtools/mjrty.pdf">论文</a>，算法解决的问题是如何在任意多的候选人（选票无序），选出获得票数最多的那个。常见的算法是扫描一遍选票，对每个候选人进行统计的选票进行统计。当候选人的数目固定时，这个常见算法的时间复杂度为：$O(n)$，当候选人的数目不定时，统计选票可能会执行较长时间，可能需运行$O(n^2)$的时间。当选票有序时，可以很容易编出$O(n)$的程序，首先找到中位数，然后检查中位数的个数是否超过选票的一半。这篇论文针对无序且侯选人不定的情形，提出了摩尔投票算法。算法的比较次数最多是选票（记为n）的两倍，可以在$O(n)$时间内选出获票最多的，空间开销为$O(1)$。</p>
<h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><blockquote>
<p><img src="/images/2020/02/6bba7e6867007df07a6f887e20578913.png" alt=""></p>
</blockquote>
<ul>
<li>形象化描述</li>
</ul>
<p>想象着这样一个画面：会议大厅站满了投票代表，每个都有一个牌子上面写着自己所选的候选人的名字。然后选举意见不合的（所选的候选人不同）两个人，会打一架，并且会同时击倒对方。显而易见，如果一个人拥有的选票比其它所有人加起来的选票还要多的话，这个候选人将会赢得这场“战争”，当混乱结束，最后剩下的那个代表（可能会有多个）将会来自多数人所站的阵营。但是如果所有参加候选人的选票都不是大多数（选票都未超过一半），那么最后站在那的代表（一个人）并不能代表所有的选票的大多数。因此，当某人站到最后时，需要统计他所选的候选人的选票是否超过一半（包括倒下的），来判断选票结果是否有效。</p>
<blockquote>
<p><img src="/images/2020/02/5e54af168b5a71ac4d82df10f01f1b57.png" alt=""></p>
</blockquote>
<ul>
<li>算法步骤</li>
</ul>
<p>算法分为两个阶段：<strong>pairing</strong>阶段和<strong>counting</strong>阶段。</p>
<ol>
<li><p><strong>pairing</strong>阶段：两个不同选票的人进行对抗，并会同时击倒对方，当剩下的人都是同一阵营，相同选票时，结束。</p>
</li>
<li><p><strong>counting</strong>阶段：计数阶段，对最后剩下的下进行选票计算统计，判断选票是否超过总票数的一半，选票是否有效。</p>
</li>
</ol>
<blockquote>
<p><img src="/images/2020/02/7bde43514d0c37a58b31d450d109c4df.png" alt=""></p>
</blockquote>
<ul>
<li><strong>pairing</strong>阶段的简化</li>
</ul>
<p>选票不同就要大干一架，太过粗鲁，这里提供一种更加现代化的文明方式。 在场的有个叫<code>onwaier</code>的，他很聪明，他想到一个方法。他用他那犀利人目光扫一遍所有代表们的选票，在脑子记住两件事，当前的候选人的名字<code>cand</code>和他对应的计数<code>k</code>（并不是他的选票数）。起始时，<code>k</code>的值为0，看每个人的选票时，先想想现在<code>k</code>是否为0，如果是0就将<code>cand</code>更新为他将看到的候选人的名字并且将<code>k</code>的值更新为1。观察每个人选票的过程，如果这个人的选票与<code>cand</code>相同，则将<code>k</code>的值加1；否则，将<code>k</code>的值减1。最后的<code>cand</code>可能胜选，还需统计他的总选票数是否超过一半。</p>
<h3 id="算法证明"><a href="#算法证明" class="headerlink" title="算法证明"></a>算法证明</h3><blockquote>
<p><img src="/images/2020/02/4cefdcdf7b2de8fd13ff4f5d4d47f82b.png" alt=""></p>
</blockquote>
<p><strong>证明</strong>： 假设共有n个代表（一人一票，选票总数为n）。当<code>onwaier</code>看到第i个代表的选票时$(1 \leq i \leq n)$，前面他已经看到的所有选票可以分为两组，第一组是<code>k</code>个代表赞同<code>cand</code>；另一组是选票可以全部成对（选票不同）抵销。当处理完所有的选票时，如果存在大多数，则<code>cand</code>当选。 假设存在一个<code>x</code>其不同于<code>cand</code>，但拥有的选票超过$n/2$。但因为第二组的选票可以全部成对抵销，所以<code>x</code>最多的选票数为$(n - k) / 2$，因此<code>x</code>必须要收到第一组的选票才能超过一半，但是第一组的选票都是<code>cand</code>的，出现矛盾，假设不成立。 所以，如果存在大多数，<code>cand</code>就是那个。</p>
<h3 id="算法演示"><a href="#算法演示" class="headerlink" title="算法演示"></a>算法演示</h3><p>来自<a target="_blank" rel="noopener" href="https://www.cs.utexas.edu/~moore/best-ideas/mjrty/index.html">网站</a> 选票情况为： A A A C C B B C C C B C C 结果应该是<code>C</code></p>
<ul>
<li>算法执行过程 <img src="/images/2020/02/algo.gif" alt=""></li>
</ul>
<h3 id="算法代码"><a href="#算法代码" class="headerlink" title="算法代码"></a>算法代码</h3><ul>
<li>伪代码</li>
</ul>
<p>伪代码来自<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_majority_vote_algorithm">维基百科</a></p>
<blockquote>
<p><img src="/images/2020/02/d9c9ad72b724fb9989247f9050df9b40.png" alt=""></p>
</blockquote>
<ul>
<li>c++代码</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">根据多数元素出现的次数大于n/2且超过其它元素出现次数之和这一特点，进行统计</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">时间复杂度为：O(n)</span></span><br><span class="line"><span class="comment">空间复杂度为：O(1)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, cand = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//成对抵销阶阶段</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)&#123;</span><br><span class="line">        <span class="keyword">if</span>(k == <span class="number">0</span>)&#123;</span><br><span class="line">            cand = num;</span><br><span class="line">            k = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(num == cand)&#123;</span><br><span class="line">                ++k;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                --k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//计数阶段 判断cand的个数是否超过一半</span></span><br><span class="line">    k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)&#123;</span><br><span class="line">        <span class="keyword">if</span>(num == cand)&#123;</span><br><span class="line">            ++k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(k &lt;= nums.<span class="built_in">size</span>() / <span class="number">2</span>)&#123;</span><br><span class="line">        cand = <span class="number">-1</span>;<span class="comment">//表示未超过一半 </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cand;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="算法应用"><a href="#算法应用" class="headerlink" title="算法应用"></a>算法应用</h2><p>摩尔投票法的一大应用就是求众数。 相关题目有：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/majority-element/">169. 多数元素</a></li>
</ol>
<p>其中题1的代码和上面的c++代码相同，它就是摩尔选票法的直接应用。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">根据多数元素出现的次数大于n/2且超过其它元素出现次数之和这一特点，进行统计</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">时间复杂度为：O(n)</span></span><br><span class="line"><span class="comment">空间复杂度为：O(1)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">摩尔选票法的直接应用，因为题目说明一定存在大多数，所以不用进行第二阶段</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>, res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cnt == <span class="number">0</span>)&#123;</span><br><span class="line">                res = num;</span><br><span class="line">                cnt = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(num == res)&#123;</span><br><span class="line">                    ++cnt;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    --cnt;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/majority-element-ii/">229. 求众数 II</a></li>
</ol>
<p>题2的代码则是摩尔选票法的变形。 题2可以看成这样一个情形：一个班里要选副班长，至多2位。每一个投一票，成为副班长得票必须超过总票数的三分之一。 因为可能会产生两名。所以候选人$cand$与计数$cnt$都转成相应的数组形式$cands$与$cnts$，长度都为2。 第一阶段成对抵销时，<code>cands[0]</code>与<code>cands[1]</code>的选票不相互抵销，即如果代表将票投给了<code>cands[0]</code>，则<code>cands[1]</code>对应的<code>cnts[1]</code>的值不变化。 投给<code>cands[1]</code>也是同样的道理。这样就转化成摩尔投票法的原始情形了。 第二阶段计数时，除了要判断两个候选的票数是否超过三分之一，还需判断两个候选是否相同。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">时间复杂度为：O(n)</span></span><br><span class="line"><span class="comment">空间复杂度为：O(1)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;res, cands, cnts;</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">0</span>)&#123;<span class="comment">//没有元素，直接返回空数组</span></span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        cands.<span class="built_in">assign</span>(<span class="number">2</span>, nums[<span class="number">0</span>]);</span><br><span class="line">        cnts.<span class="built_in">assign</span>(<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//第1阶段 成对抵销</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num: nums)&#123;</span><br><span class="line">            <span class="type">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; cands.<span class="built_in">size</span>(); ++i)&#123;</span><br><span class="line">                <span class="keyword">if</span>(num == cands[i])&#123;</span><br><span class="line">                    ++cnts[i];</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">                <span class="type">bool</span> flag2 = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; cands.<span class="built_in">size</span>(); ++j)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(cnts[j] == <span class="number">0</span>)&#123;</span><br><span class="line">                        flag2 = <span class="literal">true</span>;</span><br><span class="line">                        cands[j] = num;</span><br><span class="line">                        cnts[j]++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!flag2)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; cnts.<span class="built_in">size</span>(); ++j)&#123;</span><br><span class="line">                        --cnts[j];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第2阶段 计数 数目要超过三分之一</span></span><br><span class="line">        cnts[<span class="number">0</span>] = cnts[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(cands[<span class="number">0</span>] == cands[<span class="number">1</span>])</span><br><span class="line">            cands.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; cands.<span class="built_in">size</span>(); ++i)&#123;</span><br><span class="line">                <span class="keyword">if</span>(cands[i] == num)&#123;</span><br><span class="line">                    ++cnts[i];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; cands.<span class="built_in">size</span>(); ++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cnts[i] &gt; len / <span class="number">3</span>)&#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(cands[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li>至多选出m个代表，每个选票数大于n / (m + 1)</li>
</ol>
<p>只需要将题2的判断最后候选是否相同代码进行修改即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/29/dlib%E5%AE%9E%E7%8E%B0%E8%84%B8%E9%83%A8%E5%88%86%E5%89%B2%E4%B8%8E%E4%BA%BA%E8%84%B8%E5%AF%B9%E9%BD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/29/dlib%E5%AE%9E%E7%8E%B0%E8%84%B8%E9%83%A8%E5%88%86%E5%89%B2%E4%B8%8E%E4%BA%BA%E8%84%B8%E5%AF%B9%E9%BD%90/" class="post-title-link" itemprop="url">dlib实现脸部分割与人脸对齐</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-29 17:27:03" itemprop="dateCreated datePublished" datetime="2020-01-29T17:27:03+08:00">2020-01-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:04:08" itemprop="dateModified" datetime="2022-02-13T14:04:08+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BA%BA%E8%84%B8%E8%A1%A8%E6%83%85%E8%AF%86%E5%88%AB/" itemprop="url" rel="index"><span itemprop="name">人脸表情识别</span></a>
        </span>
    </span>

  
    <span id="/2020/01/29/dlib%E5%AE%9E%E7%8E%B0%E8%84%B8%E9%83%A8%E5%88%86%E5%89%B2%E4%B8%8E%E4%BA%BA%E8%84%B8%E5%AF%B9%E9%BD%90/" class="post-meta-item leancloud_visitors" data-flag-title="dlib实现脸部分割与人脸对齐" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/29/dlib%E5%AE%9E%E7%8E%B0%E8%84%B8%E9%83%A8%E5%88%86%E5%89%B2%E4%B8%8E%E4%BA%BA%E8%84%B8%E5%AF%B9%E9%BD%90/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/29/dlib实现脸部分割与人脸对齐/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/liuxiao214/article/details/83411820">【Dlib】人脸检测、特征点检测、人脸对齐、人脸识别</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wujuxkkoolerter/article/details/86152586">深度学习与人脸识别之-脸部分割与校正</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/AIfaceLab/FaceSegmentation">github项目FaceSegmentation</a></li>
<li><a target="_blank" rel="noopener" href="http://dlib.net/face_alignment.py.html">http://dlib.net/face_alignment.py.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/268307551">知乎问答</a></li>
</ol>
<h2 id="关键点检测"><a href="#关键点检测" class="headerlink" title="关键点检测"></a>关键点检测</h2><p>首先获取模型，下载地址在<a target="_blank" rel="noopener" href="http://dlib.net/files/">这</a>，我使用的是获取脸部68个关键点的<a target="_blank" rel="noopener" href="http://onwaier.com:7777/share/e9FOpQTO">模型<code>shape_predictor_68_face_landmarks.dat</code></a> 68关键点位置示意图如下： <img src="/images/2020/01/bc388216b03bc751c8a6505207243e59.png" alt=""> 首先贴出python代码 ` ```python<br>“””<br>代码功能：</p>
<ol>
<li>用dlib人脸检测器检测出人脸，返回的人脸矩形框</li>
<li>对检测出的人脸进行关键点检测并用圈进行标记</li>
<li>将检测出的人脸关键点信息写到txt文本中<br>“””<br>import cv2<br>import dlib<br>import numpy as np</li>
</ol>
<p>predictor_model = ‘shape_predictor_68_face_landmarks.dat’<br>detector = dlib.get_frontal_face_detector()# dlib人脸检测器<br>predictor = dlib.shape_predictor(predictor_model)</p>
<h1 id="cv2读取图像"><a href="#cv2读取图像" class="headerlink" title="cv2读取图像"></a>cv2读取图像</h1><p>test_img_path = “input/Messi.jpg”<br>output_pos_info = “output_pos_info/Messi.txt”<br>img = cv2.imread(test_img_path)<br>file_handle = open(output_pos_info, ‘a’)</p>
<h1 id="取灰度"><a href="#取灰度" class="headerlink" title="取灰度"></a>取灰度</h1><p>img_gray = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)</p>
<h1 id="人脸数rects（rectangles）"><a href="#人脸数rects（rectangles）" class="headerlink" title="人脸数rects（rectangles）"></a>人脸数rects（rectangles）</h1><p>rects = detector(img_gray, 0)</p>
<p>for i in range(len(rects)):<br>    landmarks = np.matrix([[p.x, p.y] for p in predictor(img,rects[i]).parts()])<br>    for idx, point in enumerate(landmarks):</p>
<pre><code>    # 68点的坐标
    pos = (point[0, 0], point[0, 1])
    print(idx+1, pos)
    pos_info = str(point[0, 0]) + &#39; &#39; + str(point[0, 1]) + &#39;\n&#39;
    file_handle.write(pos_info)
    # 利用cv2.circle给每个特征点画一个圈，共68个
    cv2.circle(img, pos, 3, color=(0, 255, 0))
    # 利用cv2.putText输出1-68
    #font = cv2.FONT_HERSHEY_SIMPLEX
    #cv2.putText(img, str(idx+1), pos, font, 0.5, (0, 0, 255), 1, cv2.LINE_AA)
</code></pre><p>file_handle.close()<br>cv2.imwrite(“output/Messi_keypoints.png”, img)<br><figure class="highlight plaintext"><figcaption><span>大致过程如下：先用人脸检测器获取到人脸矩形框rectangles，再用68点shape模型获取`full_object_detection`对象。最后将关键点标记出来，并写入文本中。 `rects </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```python</span><br><span class="line">predictor = dlib.shape_predictor(predictor_model)</span><br><span class="line">predictor(img,rects[i]).parts()</span><br><span class="line">predictor(img, rects[i]).part(1)</span><br></pre></td></tr></table></figure></p>
<p>predictor返回的是一个<code>full_object_detection</code>对象，通过<code>parts()</code>可以获得所有关键点的位置，通过<code>part(idx)</code>idx从0开始，可以获取某个关键点的信息。 <img src="/images/2020/01/0b76bab4c8876e791592ab1ba4bfb760.png" alt=""> 测试图片的原图与标注关键点后图片如下图所示。 <img src="/images/2020/01/63d16c7784509d2f8880da7e92b37d9c.png" alt=""> <img src="/images/2020/01/a8fc125fa7af4ec67798e3ba6ee2290e.png" alt=""></p>
<h2 id="脸部分割"><a href="#脸部分割" class="headerlink" title="脸部分割"></a>脸部分割</h2><p>两种方式：矩形框分割人脸和 不规则形状分割人脸</p>
<h3 id="矩形框分割人脸"><a href="#矩形框分割人脸" class="headerlink" title="矩形框分割人脸"></a>矩形框分割人脸</h3><p>可以采用<code>dlib.get_face_chip()</code>来分割人脸</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">代码功能：</span></span><br><span class="line"><span class="string">1. 用dlib人脸检测器检测出人脸，返回的人脸矩形框</span></span><br><span class="line"><span class="string">2. 对检测出的人脸进行关键点检测并切割出人脸</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> dlib</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">predictor_model = <span class="string">&#x27;shape_predictor_68_face_landmarks.dat&#x27;</span></span><br><span class="line">detector = dlib.get_frontal_face_detector()<span class="comment"># dlib人脸检测器</span></span><br><span class="line">predictor = dlib.shape_predictor(predictor_model)</span><br><span class="line"></span><br><span class="line"><span class="comment"># cv2读取图像</span></span><br><span class="line">test_img_path = <span class="string">&quot;input/Messi.jpg&quot;</span></span><br><span class="line">img = cv2.imread(test_img_path)</span><br><span class="line">img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span><br><span class="line"><span class="comment"># 人脸数rects</span></span><br><span class="line">rects = detector(img, <span class="number">0</span>)</span><br><span class="line"><span class="comment"># faces存储full_object_detection对象</span></span><br><span class="line">faces = dlib.full_object_detections()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(rects)):</span><br><span class="line">    faces.append(predictor(img,rects[i]))</span><br><span class="line"></span><br><span class="line">face_images = dlib.get_face_chips(img, faces, size=<span class="number">320</span>)</span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> face_images:</span><br><span class="line">    cv_bgr_img = cv2.cvtColor(image, cv2.COLOR_RGB2BGR)</span><br><span class="line">    cv2.imwrite(<span class="string">&#x27;output/Messi_clip.png&#x27;</span>, cv_bgr_img)</span><br></pre></td></tr></table></figure>
<p>Dlib检测出的脸部区域对于下巴和额头区域会做过多的裁剪，并且分割使用的是矩形框。 分割结果如图 <img src="/images/2020/01/41bcb607dddb2e1b274cfa79516723c8.png" alt=""></p>
<h3 id="不规则形状分割人脸"><a href="#不规则形状分割人脸" class="headerlink" title="不规则形状分割人脸"></a>不规则形状分割人脸</h3><blockquote>
<p>先用dlib等打点工具把人脸最外层的landmark点打出来，然后利用opencv的convexhull得到凸包然后就可以抠出人脸区域了.</p>
</blockquote>
<p>python代码(获取人脸的掩模)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_image_hull_mask</span>(<span class="params">image_shape, image_landmarks, ie_polys=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment"># get the mask of the image</span></span><br><span class="line">    <span class="keyword">if</span> image_landmarks.shape[<span class="number">0</span>] != <span class="number">68</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(</span><br><span class="line">            <span class="string">&#x27;get_image_hull_mask works only with 68 landmarks&#x27;</span>)</span><br><span class="line">    int_lmrks = np.array(image_landmarks, dtype=np.<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#hull_mask = np.zeros(image_shape[0:2]+(1,), dtype=np.float32)</span></span><br><span class="line">    hull_mask = np.full(image_shape[<span class="number">0</span>:<span class="number">2</span>] + (<span class="number">1</span>,), <span class="number">0</span>, dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    cv2.fillConvexPoly(hull_mask, cv2.convexHull(</span><br><span class="line">        np.concatenate((int_lmrks[<span class="number">0</span>:<span class="number">9</span>],</span><br><span class="line">                        int_lmrks[<span class="number">17</span>:<span class="number">18</span>]))), (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    cv2.fillConvexPoly(hull_mask, cv2.convexHull(</span><br><span class="line">        np.concatenate((int_lmrks[<span class="number">8</span>:<span class="number">17</span>],</span><br><span class="line">                        int_lmrks[<span class="number">26</span>:<span class="number">27</span>]))), (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    cv2.fillConvexPoly(hull_mask, cv2.convexHull(</span><br><span class="line">        np.concatenate((int_lmrks[<span class="number">17</span>:<span class="number">20</span>],</span><br><span class="line">                        int_lmrks[<span class="number">8</span>:<span class="number">9</span>]))), (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    cv2.fillConvexPoly(hull_mask, cv2.convexHull(</span><br><span class="line">        np.concatenate((int_lmrks[<span class="number">24</span>:<span class="number">27</span>],</span><br><span class="line">                        int_lmrks[<span class="number">8</span>:<span class="number">9</span>]))), (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    cv2.fillConvexPoly(hull_mask, cv2.convexHull(</span><br><span class="line">        np.concatenate((int_lmrks[<span class="number">19</span>:<span class="number">25</span>],</span><br><span class="line">                        int_lmrks[<span class="number">8</span>:<span class="number">9</span>],</span><br><span class="line">                        ))), (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    cv2.fillConvexPoly(hull_mask, cv2.convexHull(</span><br><span class="line">        np.concatenate((int_lmrks[<span class="number">17</span>:<span class="number">22</span>],</span><br><span class="line">                        int_lmrks[<span class="number">27</span>:<span class="number">28</span>],</span><br><span class="line">                        int_lmrks[<span class="number">31</span>:<span class="number">36</span>],</span><br><span class="line">                        int_lmrks[<span class="number">8</span>:<span class="number">9</span>]</span><br><span class="line">                        ))), (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    cv2.fillConvexPoly(hull_mask, cv2.convexHull(</span><br><span class="line">        np.concatenate((int_lmrks[<span class="number">22</span>:<span class="number">27</span>],</span><br><span class="line">                        int_lmrks[<span class="number">27</span>:<span class="number">28</span>],</span><br><span class="line">                        int_lmrks[<span class="number">31</span>:<span class="number">36</span>],</span><br><span class="line">                        int_lmrks[<span class="number">8</span>:<span class="number">9</span>]</span><br><span class="line">                        ))), (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># nose</span></span><br><span class="line">    cv2.fillConvexPoly(</span><br><span class="line">        hull_mask, cv2.convexHull(int_lmrks[<span class="number">27</span>:<span class="number">36</span>]), (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ie_polys <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        ie_polys.overlay_mask(hull_mask)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="keyword">return</span> hull_mask</span><br></pre></td></tr></table></figure>
<p>方法利用的就是opencv的convexhull得到凸包然后就可以抠出人脸区域。 得到掩模，这里使用两种方式来得到人脸区域 1. 将mask作为$\\alpha$通道，来控制图片区域的透明度，最后得到图片是4通道的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge_add_alpha</span>(<span class="params">img_1, mask</span>):</span><br><span class="line">    <span class="comment"># merge rgb and mask into a rgba image</span></span><br><span class="line">    r_channel, g_channel, b_channel = cv2.split(img_1)</span><br><span class="line">    <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        alpha_channel = np.ones(mask.shape, dtype=img_1.dtype)</span><br><span class="line">        alpha_channel *= mask*<span class="number">255</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        alpha_channel = np.zeros(img_1.shape[:<span class="number">2</span>], dtype=img_1.dtype)</span><br><span class="line">    img_BGRA = cv2.merge((b_channel, g_channel, r_channel, alpha_channel))</span><br><span class="line">    <span class="keyword">return</span> img_BGRA</span><br></pre></td></tr></table></figure>
<p>分割结果 <img src="/images/2020/01/fac8463e6dfcc01af5f1f95560df7787.png" alt=""></p>
<ol>
<li>掩模与原始图像进行与运算，返回图像是三通道。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge_add_mask</span>(<span class="params">img_1, mask</span>):</span><br><span class="line">    <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        height = mask.shape[<span class="number">0</span>]</span><br><span class="line">        width = mask.shape[<span class="number">1</span>]</span><br><span class="line">        channel_num = mask.shape[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(channel_num):</span><br><span class="line">                    <span class="keyword">if</span> mask[row, col, c] == <span class="number">0</span>:</span><br><span class="line">                        mask[row, col, c] = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        mask[row, col, c] = <span class="number">255</span></span><br><span class="line"></span><br><span class="line">        r_channel, g_channel, b_channel = cv2.split(img_1)</span><br><span class="line">        r_channel = cv2.bitwise_and(r_channel, mask)</span><br><span class="line">        g_channel = cv2.bitwise_and(g_channel, mask)</span><br><span class="line">        b_channel = cv2.bitwise_and(b_channel, mask)</span><br><span class="line">        res_img = cv2.merge((b_channel, g_channel, r_channel))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res_img = img_1</span><br><span class="line">    <span class="keyword">return</span> res_img</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>分割结果为 <img src="/images/2020/01/1f008f4ffc9f58946de4579a8e71e2fd.png" alt=""></p>
<h2 id="人脸对齐"><a href="#人脸对齐" class="headerlink" title="人脸对齐"></a>人脸对齐</h2><p>思路比较简单，计算两眼连线与水平线的夹角，然后通过角度得到对应的旋转矩阵。对图片进行相应的变换。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">single_face_alignment</span>(<span class="params">face, landmarks</span>):</span><br><span class="line">    eye_center = ((landmarks[<span class="number">36</span>, <span class="number">0</span>] + landmarks[<span class="number">45</span>, <span class="number">0</span>]) * <span class="number">1.</span> / <span class="number">2</span>,  <span class="comment"># 计算两眼的中心坐标</span></span><br><span class="line">                  (landmarks[<span class="number">36</span>, <span class="number">1</span>] + landmarks[<span class="number">45</span>, <span class="number">1</span>]) * <span class="number">1.</span> / <span class="number">2</span>)</span><br><span class="line">    dx = (landmarks[<span class="number">45</span>, <span class="number">0</span>] - landmarks[<span class="number">36</span>, <span class="number">0</span>])  <span class="comment"># note: right - right</span></span><br><span class="line">    dy = (landmarks[<span class="number">45</span>, <span class="number">1</span>] - landmarks[<span class="number">36</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    angle = math.atan2(dy, dx) * <span class="number">180.</span> / math.pi  <span class="comment"># 计算角度</span></span><br><span class="line">    RotateMatrix = cv2.getRotationMatrix2D(eye_center, angle, scale=<span class="number">1</span>)  <span class="comment"># 计算仿射矩阵</span></span><br><span class="line">    align_face = cv2.warpAffine(face, RotateMatrix, (face.shape[<span class="number">0</span>], face.shape[<span class="number">1</span>]))  <span class="comment"># 进行放射变换，即旋转</span></span><br><span class="line">    <span class="keyword">return</span> align_face</span><br></pre></td></tr></table></figure>
<p>人脸对齐后如图 <img src="/images/2020/01/d371e91bffc8b8158b282a0d5115bc00.png" alt=""> 这样就完成人脸检测—&gt;人脸关键点检测—&gt;人脸分割—&gt;人脸对齐。 具体代码参照<a target="_blank" rel="noopener" href="https://github.com/Onwaier/SegfaceAndAlignByDlib">github</a> 可以用以上方法对fer2013数据集进行预处理，如图所示。 <img src="/images/2020/01/9b242c562a1fb5a0b059ae1bf4218aa6.png" alt=""></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/28/%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BD%E4%BE%A7%E8%BE%B9%E6%A0%8F%E8%B7%9F%E9%9A%8F%E5%9B%BA%E5%AE%9A%E8%8C%83%E5%9B%B4%E6%B5%AE%E5%8A%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/28/%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BD%E4%BE%A7%E8%BE%B9%E6%A0%8F%E8%B7%9F%E9%9A%8F%E5%9B%BA%E5%AE%9A%E8%8C%83%E5%9B%B4%E6%B5%AE%E5%8A%A8/" class="post-title-link" itemprop="url">实现智能侧边栏跟随固定范围浮动</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-28 11:23:46" itemprop="dateCreated datePublished" datetime="2020-01-28T11:23:46+08:00">2020-01-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:02:56" itemprop="dateModified" datetime="2022-02-13T14:02:56+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/wordpress/" itemprop="url" rel="index"><span itemprop="name">wordpress</span></a>
        </span>
    </span>

  
    <span id="/2020/01/28/%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BD%E4%BE%A7%E8%BE%B9%E6%A0%8F%E8%B7%9F%E9%9A%8F%E5%9B%BA%E5%AE%9A%E8%8C%83%E5%9B%B4%E6%B5%AE%E5%8A%A8/" class="post-meta-item leancloud_visitors" data-flag-title="实现智能侧边栏跟随固定范围浮动" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/28/%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BD%E4%BE%A7%E8%BE%B9%E6%A0%8F%E8%B7%9F%E9%9A%8F%E5%9B%BA%E5%AE%9A%E8%8C%83%E5%9B%B4%E6%B5%AE%E5%8A%A8/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/28/实现智能侧边栏跟随固定范围浮动/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>我的博客是两列布局，当文章内容过多时，向下滑动，左侧栏会出现空白，影响阅读体验。想要实现这种效果：当左侧栏滑到底时，不继续左边内容向下滑动。查阅网上的资料，实现的方法大致分为三种。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>解决方法大致分为两种类型：通过插件实现或者修改代码。</p>
<h3 id="插件Q2W3-Fixed-Widget"><a href="#插件Q2W3-Fixed-Widget" class="headerlink" title="插件Q2W3 Fixed Widget"></a>插件Q2W3 Fixed Widget</h3><p>参考<a target="_blank" rel="noopener" href="https://www.freeluffy.com/q2w3-fixed-widget/">博客</a>，我添加后没有达到理想效果，可能是哪里没设置好或者设置冲突。 - 安装插件 通过插件安装器搜索或者zip压缩包安装即可.</p>
<ul>
<li><p>设置Widget固定 先启动插件<code>Q2W3 Fixed Widget</code>，然后点击<code>外观-&gt;小工具</code>. 对于添加在左侧栏的小工具，多了一个设置选项。如图所示。 <img src="/images/2020/01/ccca529e7f22a669404f043baa87a2cf.png" alt=""> 将需要固定的工具的<code>Fixed widget</code>勾上即可。</p>
<h3 id="修改代码"><a href="#修改代码" class="headerlink" title="修改代码"></a>修改代码</h3><p>参照<a target="_blank" rel="noopener" href="http://wanlimm.com/77201807015793.html">博客</a></p>
<ol>
<li>修改js和css代码</li>
</ol>
<ul>
<li>修改<code>single.php</code>文件 在文件最后添加如下代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;http://code.jquery.com/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> offset_left = $(<span class="string">&quot;.sidebar&quot;</span>).<span class="title function_">offset</span>().<span class="property">left</span>; <span class="comment">//body左边距 = 右边距</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> sidebar_w = $(<span class="string">&quot;.sidebar&quot;</span>).<span class="title function_">width</span>(); <span class="comment">//侧边栏宽度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> sidebar_h = $(<span class="string">&quot;.sidebar&quot;</span>).<span class="title function_">outerHeight</span>(); <span class="comment">//侧边栏高</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> sidebar_top = $(<span class="string">&quot;.sidebar&quot;</span>).<span class="title function_">offset</span>().<span class="property">top</span>; <span class="comment">//侧边栏上边距</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>(sidebar_top + sidebar_h)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>($(<span class="variable language_">window</span>).<span class="title function_">height</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>($(<span class="variable language_">document</span>).<span class="title function_">height</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">innerHeight</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$(<span class="variable language_">document</span>).<span class="title function_">scroll</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> scroll_h = $(<span class="variable language_">document</span>).<span class="title function_">scrollTop</span>(); <span class="comment">//滚动条高度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span>( scroll_h &gt; (sidebar_top+sidebar_h - <span class="variable language_">window</span>.<span class="property">innerHeight</span>))&#123; <span class="comment">//当滚动条高度 &gt; 侧边栏底部到顶部的高</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        $(<span class="string">&quot;.sidebar&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;fixed&quot;</span>);  <span class="comment">//给侧边栏添加fixed类</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        $(<span class="string">&quot;.fixed&quot;</span>).<span class="title function_">css</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;width&#x27;</span>:sidebar_w+<span class="string">&#x27;px&#x27;</span>, <span class="comment">//设置宽度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;top&#x27;</span>:sidebar_top + <span class="string">&#x27;px&#x27;</span> <span class="comment">//设置上边距</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;<span class="keyword">else</span>&#123; <span class="comment">//如果滚动条高度 &lt;  侧边栏底部到顶部的高</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        $(<span class="string">&quot;.sidebar&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;fixed&quot;</span>);  <span class="comment">//去除侧边栏的fixed类</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>修改<code>style.css</code> 在<code>style.css</code>查找<code>.sidebar</code>在其下面添加类fixed的样式代码。</li>
</ul>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.fixed</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>:fixed;</span><br><span class="line">    <span class="attribute">z-index</span>:<span class="number">999</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后实现效果如图所求。 <img src="/images/2020/01/fix1.gif" alt=""> 最后实现效果是左侧栏滑到底时，直接回到顶部。</p>
<ol>
<li>利用第三方js代码 参照<a target="_blank" rel="noopener" href="https://www.mybj123.com/4288.html">博客</a></li>
</ol>
<ul>
<li>下载第三方js 在<a target="_blank" rel="noopener" href="https://github.com/WeCodePixels/theia-sticky-sidebar">github</a>下载<code>theia-sticky-sidebar</code></li>
</ul>
<p>放到js目录下，我的目录位置为：<code>/www/wwwroot/onwaier.com/wp-content/themes/twentyfifteen/js</code></p>
<ul>
<li>修改<code>single.php</code>代码 在原代码最后加入以下代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;http://code.jquery.com/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;?php echo esc_url( get_template_directory_uri() ); ?&gt;/js/theia-sticky-sidebar.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="string">&#x27;.sidebar&#x27;</span>).<span class="title function_">theiaStickySidebar</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// Settings</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">additionalMarginTop</span>: <span class="number">30</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>最后实现效果如图所求。 <img src="/images/2020/01/fix2.gif" alt=""> 注意：上面代码修改都是<code>single.php</code>，只能修改每篇文章的侧栏滑动效果，如果想要修改首页的侧栏滑动效果，可以修改<code>index.php</code>的代码.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/27/pytorch%E6%9E%84%E5%BB%BA%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/27/pytorch%E6%9E%84%E5%BB%BA%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">Pytorch构建神经网络</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-27 19:59:33" itemprop="dateCreated datePublished" datetime="2020-01-27T19:59:33+08:00">2020-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:29:07" itemprop="dateModified" datetime="2022-02-13T14:29:07+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pytorch/" itemprop="url" rel="index"><span itemprop="name">pytorch</span></a>
        </span>
    </span>

  
    <span id="/2020/01/27/pytorch%E6%9E%84%E5%BB%BA%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" class="post-meta-item leancloud_visitors" data-flag-title="Pytorch构建神经网络" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/27/pytorch%E6%9E%84%E5%BB%BA%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/27/pytorch构建神经网络/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="神经网络的训练过程"><a href="#神经网络的训练过程" class="headerlink" title="神经网络的训练过程"></a>神经网络的训练过程</h2><ol>
<li><p>定义一个包含可训练参数的神经网络</p>
</li>
<li><p>迭代整个输入</p>
</li>
<li><p>通过神经网络处理输入</p>
</li>
<li><p>计算损失(loss)</p>
</li>
<li><p>反向传播梯度到神经网络的参数</p>
</li>
<li><p>更新网络的参数，典型的用一个简单的更新方法：weight = weight - learning_rate *gradient</p>
</li>
</ol>
<h2 id="定义神经网络"><a href="#定义神经网络" class="headerlink" title="定义神经网络"></a>定义神经网络</h2><p>用下面代码可以构建一个典型的神经网络</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Net</span>(nn.Module):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(Net, self).__init__()</span><br><span class="line">        <span class="comment"># 1 input image channel, 6 output channels, 5x5 square convolution</span></span><br><span class="line">        <span class="comment"># kernel</span></span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">1</span>, <span class="number">6</span>, <span class="number">5</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(<span class="number">6</span>, <span class="number">16</span>, <span class="number">5</span>)</span><br><span class="line">        <span class="comment"># an affine operation: y = Wx + b</span></span><br><span class="line">        self.fc1 = nn.Linear(<span class="number">16</span> * <span class="number">5</span> * <span class="number">5</span>, <span class="number">120</span>)</span><br><span class="line">        self.fc2 = nn.Linear(<span class="number">120</span>, <span class="number">84</span>)</span><br><span class="line">        self.fc3 = nn.Linear(<span class="number">84</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># Max pooling over a (2, 2) window</span></span><br><span class="line">        x = F.max_pool2d(F.relu(self.conv1(x)), (<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line">        <span class="comment"># If the size is a square you can only specify a single number</span></span><br><span class="line">        x = F.max_pool2d(F.relu(self.conv2(x)), <span class="number">2</span>)</span><br><span class="line">        x = x.view(-<span class="number">1</span>, self.num_flat_features(x))</span><br><span class="line">        x = F.relu(self.fc1(x))</span><br><span class="line">        x = F.relu(self.fc2(x))</span><br><span class="line">        x = self.fc3(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">num_flat_features</span>(<span class="params">self, x</span>):</span><br><span class="line">        size = x.size()[<span class="number">1</span>:]  <span class="comment"># all dimensions except the batch dimension</span></span><br><span class="line">        num_features = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> size:</span><br><span class="line">            num_features *= s</span><br><span class="line">        <span class="keyword">return</span> num_features</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net = Net()</span><br><span class="line"><span class="built_in">print</span>(net)</span><br></pre></td></tr></table></figure>
<h3 id="Conv2d"><a href="#Conv2d" class="headerlink" title="Conv2d"></a><a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/nn.html?highlight=nn%20conv2d#torch.nn.Conv2d">Conv2d</a></h3><p><strong>方法原型</strong> <code>torch.nn.Conv2d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True, padding_mode=&#39;zeros&#39;)</code> <strong>参数说明</strong> - <code>in_channels</code>:输入图片的通道数 - <code>out_channels</code>:卷积操作后输出图片的通道数 - <code>kernel_size</code>:卷积核的尺寸 - <code>stride</code>:卷积的步长，默认为1 - <code>padding</code>:卷积的padding，默认为0 <code>kernel_size</code>, <code>stride</code>, <code>padding</code>取值可以为<code>a single int</code>或者<code>a tuple of two ints</code>，<code>a single int</code>表示宽和高相同。<code>a tuple of two ints</code>表示第1个为宽的大小，第2个为高的大小。 计算输出图片的尺寸的方法：（dilation的值默认为1） <img src="/images/2020/01/d76f4d4ebdb3f0dcd025121b37833b88.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">m = nn.Conv2d(<span class="number">16</span>, <span class="number">33</span>, <span class="number">3</span>, stride=<span class="number">2</span>)</span><br><span class="line"><span class="built_in">input</span> = torch.randn(<span class="number">20</span>, <span class="number">16</span>, <span class="number">50</span>, <span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(m(<span class="built_in">input</span>).size())</span><br><span class="line">m = nn.Conv2d(<span class="number">16</span>, <span class="number">33</span>, (<span class="number">3</span>, <span class="number">5</span>), stride=(<span class="number">2</span>, <span class="number">1</span>), padding=(<span class="number">4</span>, <span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(m(<span class="built_in">input</span>).size())</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/69e6b29c6990b04ea51ea103b8ebf214.png" alt=""></p>
<h3 id="Linear"><a href="#Linear" class="headerlink" title="Linear"></a><a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/nn.html?highlight=linear#torch.nn.Linear">Linear</a></h3><p><strong>方法原型</strong> <code>torch.nn.Linear(in_features, out_features, bias=True)</code> $y = xW^T + b$ 对传入的数据进行线性变换。 <strong>参数说明</strong> <code>in_features</code>: 每个输入样例的尺寸 <code>out_features</code>:每个输出样例的尺寸 <code>bias</code>:如果设置为<code>False</code>，则不会学习额外的bias参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m = nn.Linear(<span class="number">20</span>, <span class="number">30</span>)</span><br><span class="line"><span class="built_in">input</span> = torch.randn(<span class="number">128</span>, <span class="number">20</span>)</span><br><span class="line">output = m(<span class="built_in">input</span>)</span><br><span class="line"><span class="built_in">print</span>(output.size())</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/241be8826b081a8cdf2b76062e7c65ee.png" alt=""></p>
<h3 id="max-pool2d"><a href="#max-pool2d" class="headerlink" title="max_pool2d"></a><a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/nn.functional.html?highlight=max_pool2d#torch.nn.functional.max_pool2d">max_pool2d</a></h3><p>最大池化 <strong>方法原型</strong> torch.nn.functional.max_pool3d(*args, ** kwargs) 细节参考<a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/nn.html#torch.nn.MaxPool2d">MaxPool2d</a> <code>torch.nn.MaxPool2d(kernel_size, stride=None, padding=0, dilation=1, return_indices=False, ceil_mode=False)</code> <strong>参数说明</strong> 略</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m = nn.MaxPool2d(<span class="number">3</span>, stride=<span class="number">2</span>)</span><br><span class="line"><span class="built_in">input</span> = torch.randn(<span class="number">20</span>, <span class="number">16</span>, <span class="number">50</span>, <span class="number">32</span>)</span><br><span class="line">output = m(<span class="built_in">input</span>)</span><br><span class="line"><span class="built_in">print</span>(output.size())</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/89f6d7dd0aa1f5a2117f791de6b3e1f3.png" alt=""></p>
<h3 id="relu"><a href="#relu" class="headerlink" title="relu"></a><a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/nn.functional.html?highlight=relu#torch.nn.functional.relu">relu</a></h3><p><strong>方法原型</strong> <code>torch.nn.functional.relu(input, inplace=False) → Tensor</code> relu激活函数 细节参照<a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/nn.html#torch.nn.ReLU">ReLU</a> $ReLU(x)=max(0,x)$ <img src="/images/2020/01/96ebadd4f0377c4cdb645f3ad0945458.png" alt=""></p>
<h3 id="net-parameters"><a href="#net-parameters" class="headerlink" title="net.parameters()"></a>net.parameters()</h3><p>一个模型可训练的参数可以通过调用 net.parameters() 返回</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">params = <span class="built_in">list</span>(net.parameters())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(params))</span><br><span class="line"><span class="built_in">print</span>(params[<span class="number">0</span>].size())  <span class="comment"># conv1&#x27;s .weight</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/abb85cb7f85d94c0fc2f84d0a84f9c6a.png" alt=""></p>
<h2 id="计算损失值"><a href="#计算损失值" class="headerlink" title="计算损失值"></a>计算损失值</h2><p>一个损失函数需要一对输入：模型输出和目标，nn包中提供了一些常见的损失函数。其中<code>nn.MSELoss</code>(均方差)是最简单的损失函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算损失值</span></span><br><span class="line">output = net(<span class="built_in">input</span>)</span><br><span class="line">target = torch.randn(<span class="number">10</span>)  <span class="comment"># a dummy target, for example</span></span><br><span class="line">target = target.view(<span class="number">1</span>, -<span class="number">1</span>)  <span class="comment"># make it the same shape as output</span></span><br><span class="line">criterion = nn.MSELoss()</span><br><span class="line"></span><br><span class="line">loss = criterion(output, target)</span><br><span class="line"><span class="built_in">print</span>(loss)</span><br></pre></td></tr></table></figure>
<h2 id="反向传播"><a href="#反向传播" class="headerlink" title="反向传播"></a>反向传播</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 反向传播前后conv1的偏置项的变化</span></span><br><span class="line">net.zero_grad()     <span class="comment"># zeroes the gradient buffers of all parameters</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;conv1.bias.grad before backward&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(net.conv1.bias.grad)</span><br><span class="line"></span><br><span class="line">loss.backward()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;conv1.bias.grad after backward&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(net.conv1.bias.grad)</span><br></pre></td></tr></table></figure>
<h2 id="更新神经网络参数"><a href="#更新神经网络参数" class="headerlink" title="更新神经网络参数"></a>更新神经网络参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最简单的更新规则：随机梯度下降</span></span><br><span class="line"><span class="comment"># weight = weight - learning_rate * gradient</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用python来实现这个规则</span></span><br><span class="line">learning_rate = <span class="number">0.01</span></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> net.parameters():</span><br><span class="line">    f.data.sub_(f.grad.data * learning_rate)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用内置包</span></span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line"><span class="comment"># create your optimizer</span></span><br><span class="line">optimizer = optim.SGD(net.parameters(), lr=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># in your training loop:</span></span><br><span class="line">optimizer.zero_grad()   <span class="comment"># zero the gradient buffers</span></span><br><span class="line">output = net(<span class="built_in">input</span>)</span><br><span class="line">loss = criterion(output, target)</span><br><span class="line">loss.backward()</span><br><span class="line">optimizer.step()    <span class="comment"># Does the update 实现参数更新，一般放在反向传播后面</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/27/pytorch%E8%87%AA%E5%8A%A8%E6%B1%82%E5%AF%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/27/pytorch%E8%87%AA%E5%8A%A8%E6%B1%82%E5%AF%BC/" class="post-title-link" itemprop="url">pytorch自动求导</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-27 11:09:19" itemprop="dateCreated datePublished" datetime="2020-01-27T11:09:19+08:00">2020-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 13:52:22" itemprop="dateModified" datetime="2022-02-13T13:52:22+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pytorch/" itemprop="url" rel="index"><span itemprop="name">pytorch</span></a>
        </span>
    </span>

  
    <span id="/2020/01/27/pytorch%E8%87%AA%E5%8A%A8%E6%B1%82%E5%AF%BC/" class="post-meta-item leancloud_visitors" data-flag-title="pytorch自动求导" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/27/pytorch%E8%87%AA%E5%8A%A8%E6%B1%82%E5%AF%BC/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/27/pytorch自动求导/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="科比一路走好，愿曼巴精神永存！"><a href="#科比一路走好，愿曼巴精神永存！" class="headerlink" title="科比一路走好，愿曼巴精神永存！"></a><strong>科比一路走好，愿曼巴精神永存！</strong></h1><p>具体用法参照<a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/index.html">官方文档</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">x = torch.ones(<span class="number">2</span>, <span class="number">2</span>, requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#  .requires_grad 设置为 True，则会开始跟踪针对 tensor 的所有操作</span></span><br><span class="line"><span class="comment"># 调用 .backward() 来自动计算所有梯度</span></span><br><span class="line"><span class="comment"># 调用 .detach()，它将其与计算历史记录分离</span></span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/4cb6b491c6678cb31e04fa0a3288f12f.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 针对张量进行操作</span></span><br><span class="line">y = x + <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(y)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/3f788f92348161e8a2bdb2940246f0e6.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tensor 和 Function 互相连接并构建一个非循环图，它保存整个完整的计算过程的历史信息</span></span><br><span class="line"><span class="comment"># 每个张量都有一个 .grad_fn 属性保存着创建了张量的 Function 的引用</span></span><br><span class="line"><span class="comment"># 用户自己创建张量，则g rad_fn 是 None </span></span><br><span class="line"><span class="built_in">print</span>(x.grad_fn)</span><br><span class="line"><span class="built_in">print</span>(y.grad_fn)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/2f4a974a142f57678dbb84e121385317.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对 y 做更多的操作</span></span><br><span class="line">z = y * y * <span class="number">3</span></span><br><span class="line">out = z.mean()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(z, out)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/fda278be8c27426099b2f8a771dc7774.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .requires_grad( ... ) 会改变张量的 requires_grad 标记。输入的标记默认为 False ，如果没有提供相应的参数。</span></span><br><span class="line">a = torch.randn(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">a = ((a * <span class="number">3</span>) / (a - <span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(a.requires_grad)</span><br><span class="line">a.requires_grad_(<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(a.requires_grad)</span><br><span class="line">b = (a * a).<span class="built_in">sum</span>()</span><br><span class="line"><span class="built_in">print</span>(b.grad_fn)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/242393c2cf03eb241f58dfa5d54c186b.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># out.backward(y) 后向传播</span></span><br><span class="line"><span class="built_in">print</span>(x.requires_grad, y.requires_grad, z.requires_grad)</span><br><span class="line"><span class="built_in">print</span>(out.requires_grad)</span><br><span class="line">out.backward()</span><br><span class="line"><span class="comment"># 由梯度计算的链式法则算到所有的结果变量</span></span><br><span class="line"><span class="comment"># 所计算的梯度都是结果变量关于创建变量的梯度</span></span><br><span class="line"><span class="comment"># graph leaves(事先创建，而非运行得到的中间结果)</span></span><br><span class="line"><span class="built_in">print</span>(x.grad)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/0a182c961476e9f8f0615c13758980b5.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止对跟踪历史中张量求导</span></span><br><span class="line"><span class="built_in">print</span>(x.requires_grad)</span><br><span class="line"><span class="built_in">print</span>((x ** <span class="number">2</span>).requires_grad)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    <span class="built_in">print</span>((x ** <span class="number">2</span>).requires_grad)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/4ea392629723ce2e8a8ff4c98c2f6ba9.png" alt=""> <strong>注意</strong> 1. 求导只对用户定义的变量进行，即对各个leaf Variable计算梯度 2. 运算结果变量的“requires_grad”是不可以更改的，且不会改变</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/26/pytorch%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/26/pytorch%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">pytorch入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-26 17:19:15" itemprop="dateCreated datePublished" datetime="2020-01-26T17:19:15+08:00">2020-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:29:29" itemprop="dateModified" datetime="2022-02-13T14:29:29+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pytorch/" itemprop="url" rel="index"><span itemprop="name">pytorch</span></a>
        </span>
    </span>

  
    <span id="/2020/01/26/pytorch%E5%85%A5%E9%97%A8/" class="post-meta-item leancloud_visitors" data-flag-title="pytorch入门" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/26/pytorch%E5%85%A5%E9%97%A8/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/26/pytorch入门/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考<a target="_blank" rel="noopener" href="https://pytorch.org/tutorials/">PyTorch官方教程中文版</a></p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>支持GPU，灵活，支持动态神经网络，底层代码易于理解，命令式体验。</p>
<h2 id="张量-tensor-学习"><a href="#张量-tensor-学习" class="headerlink" title="张量(tensor)学习"></a>张量(tensor)学习</h2><p>具体用法参照<a target="_blank" rel="noopener" href="https://pytorch.org/docs">官方文档</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># 构造一个5x3矩阵，不初始化。</span></span><br><span class="line">x = torch.empty((<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/ed20c4059b7d2876b35477dbae98c0cc.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构造一个随机初始化的矩阵</span></span><br><span class="line">x = torch.rand((<span class="number">5</span>, <span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/d843b2cb1db05d0a87f8acae961e95ab.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构造一个填充某个值的矩阵</span></span><br><span class="line">x = torch.full((<span class="number">5</span>, <span class="number">3</span>), <span class="number">3.1415</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/3df9c44f3e392ed46360000226f7298f.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构造全为0的矩阵，且数据类型为long</span></span><br><span class="line">x = torch.zeros((<span class="number">5</span>, <span class="number">3</span>), dtype = torch.long)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/214502b926fc8897cb2b225601a1539c.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构造单位矩阵</span></span><br><span class="line"><span class="comment"># torch.eye(n, m=None, out=None, dtype=None, layout=torch.strided, device=None, requires_grad=False) → Tensor</span></span><br><span class="line"><span class="comment"># Returns a 2-D tensor with ones on the diagonal and zeros elsewhere.</span></span><br><span class="line">torch.eye(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/3de040933ac1e2449b838670d0f3828a.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用数据构造一个张量</span></span><br><span class="line">x = torch.tensor([<span class="number">5.5</span>, <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/80e290544e3258d4747a981c07ffc1c6.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用已经存在的tensor构造一个tensor</span></span><br><span class="line">x = x.new_ones((<span class="number">5</span>, <span class="number">3</span>), dtype = torch.double)</span><br><span class="line"><span class="comment"># new_* methods take in sizes</span></span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">x = torch.randn_like(x, dtype = torch.<span class="built_in">float</span>)</span><br><span class="line"><span class="comment"># size和原x的size相同，但数据类型不同</span></span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/c88c5035e16c81a04070fb3fde64b4bb.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取维度信息 size()</span></span><br><span class="line"><span class="built_in">print</span>(x.size())</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/da1e8247bfaf5fbf426c836b02a379dd.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加法1 +</span></span><br><span class="line">y = torch.rand(<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(x + y)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/8908dce0053d4a9e7349700e1ae46e95.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加法2 torch.add</span></span><br><span class="line"><span class="comment"># torch.add(input, alpha=1, other, out=None)</span></span><br><span class="line"><span class="comment"># Each element of the tensor other is multiplied by the scalar alpha and added to each element of the tensor input. The resulting tensor is returned.</span></span><br><span class="line"><span class="built_in">print</span>(torch.add(x, y))</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/44d8b9299f68ef1623e0c4a3028a41aa.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提供一个输出tensor作为参数</span></span><br><span class="line">result = torch.empty((<span class="number">5</span>, <span class="number">3</span>))</span><br><span class="line">torch.add(x, y, out = result)</span><br><span class="line"><span class="built_in">print</span>(x + y)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/be5c19b1d4267bee2ee93ebcf78045f0.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add x to y  (in-place)</span></span><br><span class="line"><span class="comment"># 即将x+y的值赋给y</span></span><br><span class="line"><span class="comment"># 任何使张量会发生变化的操作都有一个前缀</span></span><br><span class="line">y.add_(x)</span><br><span class="line"><span class="built_in">print</span>(y)</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/3c954a7cf80df393c107c27f6797a5da.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改变大小：如果你想改变一个 tensor 的大小或者形状，你可以使用 torch.view:</span></span><br><span class="line"></span><br><span class="line">x = torch.randn(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">y = x.view(<span class="number">16</span>)</span><br><span class="line">z = x.view(-<span class="number">1</span>, <span class="number">8</span>)  <span class="comment"># the size -1 is inferred from other dimensions</span></span><br><span class="line"><span class="built_in">print</span>(x.size(), y.size(), z.size())</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/7fdd67d05badaa78ee6bb1cf9f51f2ba.png" alt=""></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/17/linux%E4%B8%8Eonedrive%E9%97%B4%E5%90%8C%E6%AD%A5-%E5%A4%87%E4%BB%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/17/linux%E4%B8%8Eonedrive%E9%97%B4%E5%90%8C%E6%AD%A5-%E5%A4%87%E4%BB%BD/" class="post-title-link" itemprop="url">linux与onedrive间同步/备份</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-17 20:41:54" itemprop="dateCreated datePublished" datetime="2020-01-17T20:41:54+08:00">2020-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:11:24" itemprop="dateModified" datetime="2022-02-13T14:11:24+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
    <span id="/2020/01/17/linux%E4%B8%8Eonedrive%E9%97%B4%E5%90%8C%E6%AD%A5-%E5%A4%87%E4%BB%BD/" class="post-meta-item leancloud_visitors" data-flag-title="linux与onedrive间同步/备份" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/17/linux%E4%B8%8Eonedrive%E9%97%B4%E5%90%8C%E6%AD%A5-%E5%A4%87%E4%BB%BD/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/17/linux与onedrive间同步-备份/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参照<a target="_blank" rel="noopener" href="https://www.moerats.com/archives/740/">博客</a>和<a target="_blank" rel="noopener" href="https://github.com/abraunegg/onedrive">github项目</a></p>
<h2 id="安装依赖（针对centos）"><a href="#安装依赖（针对centos）" class="headerlink" title="安装依赖（针对centos）"></a>安装依赖（针对centos）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &#x27;Development Tools&#x27; -y</span><br><span class="line">yum install libcurl-devel -y</span><br><span class="line">yum install sqlite-devel -y</span><br><span class="line">yum install libnotify-devel -y</span><br><span class="line">curl -fsS https://dlang.org/install.sh  bash -s dmd</span><br></pre></td></tr></table></figure>
<p>安装后返回信息 <img src="/images/2020/01/3033f485823bfe9bebed9fb0029d2555.png" alt=""> 执行<code>source ~/dlang/dmd-2.090.0/activate</code>激活环境。</p>
<h2 id="安装客户端"><a href="#安装客户端" class="headerlink" title="安装客户端"></a>安装客户端</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/abraunegg/onedrive.git</span><br><span class="line">cd onedrive</span><br><span class="line">./configure</span><br><span class="line">make clean; make;</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<h2 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h2><p>执行<code>onedrive</code>命令 <img src="/images/2020/01/797dda991ead94618f2cd17541fdeb76.png" alt=""> 复制链接，输入浏览器登录账号进行授权，再将授权后的链接地址复制到SSH客户端运行。</p>
<h2 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h2><h3 id="显示参数"><a href="#显示参数" class="headerlink" title="显示参数"></a>显示参数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onedrive --display-config</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/980f50f6f48c0f1f880338c4007b2d2c.png" alt=""></p>
<h3 id="测试参数"><a href="#测试参数" class="headerlink" title="测试参数"></a>测试参数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onedrive --synchronize --verbose --dry-run</span><br></pre></td></tr></table></figure>
<p><img src="/images/2020/01/53eb11d9054841c49634b2fc73ded73c.png" alt=""> 展示执行同步命令即将发生的。 <strong>Note</strong>: —dry-run can only be used with —synchronize. It cannot be used with —monitor and will be ignored.</p>
<h3 id="执行同步（默认）"><a href="#执行同步（默认）" class="headerlink" title="执行同步（默认）"></a>执行同步（默认）</h3><p>默认会将onedrive的所有文件下到<code>/root/onedrive</code>中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onedrive --synchronize</span><br></pre></td></tr></table></figure>
<h3 id="同步某个文件夹"><a href="#同步某个文件夹" class="headerlink" title="同步某个文件夹"></a>同步某个文件夹</h3><p>只同步OndDrive某文件夹到本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onedrive --synchronize --single-directory &#x27;&lt;dir_name&gt;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="单向—只执行下载同步"><a href="#单向—只执行下载同步" class="headerlink" title="单向—只执行下载同步"></a>单向—只执行下载同步</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onedrive --synchronize --download-only </span><br></pre></td></tr></table></figure>
<h3 id="单向—只执行上传同步"><a href="#单向—只执行上传同步" class="headerlink" title="单向—只执行上传同步"></a>单向—只执行上传同步</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onedrive --synchronize --upload-only</span><br></pre></td></tr></table></figure>
<h2 id="部分参数说明"><a href="#部分参数说明" class="headerlink" title="部分参数说明"></a>部分参数说明</h2><p>配置文件 在<code>/root/.config/onedrive</code>中 执行<code>cd /root/.config/onedrive</code>，新建配置文件<code>touch config</code>。然后将下面默认配置内容粘贴进去。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># Configuration for OneDrive Linux Client</span><br><span class="line"># This file contains the list of supported configuration fields</span><br><span class="line"># with their default values.</span><br><span class="line"># All values need to be enclosed in quotes</span><br><span class="line"># When changing a config option below, remove the &#x27;#&#x27; from the start of the line</span><br><span class="line"># For explanations of all config options below see docs/USAGE.md or the man page.</span><br><span class="line">#</span><br><span class="line"># sync_dir = &quot;~/OneDrive&quot;</span><br><span class="line"># skip_file = &quot;~*.~**.tmp&quot;</span><br><span class="line"># monitor_interval = &quot;45&quot;</span><br><span class="line"># skip_dir = &quot;&quot;</span><br><span class="line"># log_dir = &quot;/var/log/onedrive/&quot;</span><br><span class="line"># drive_id = &quot;&quot;</span><br><span class="line"># upload_only = &quot;false&quot;</span><br><span class="line"># check_nomount = &quot;false&quot;</span><br><span class="line"># check_nosync = &quot;false&quot;</span><br><span class="line"># download_only = &quot;false&quot;</span><br><span class="line"># disable_notifications = &quot;false&quot;</span><br><span class="line"># disable_upload_validation = &quot;false&quot;</span><br><span class="line"># enable_logging = &quot;false&quot;</span><br><span class="line"># force_http_11 = &quot;false&quot;</span><br><span class="line"># force_http_2 = &quot;false&quot;</span><br><span class="line"># local_first = &quot;false&quot;</span><br><span class="line"># no_remote_delete = &quot;false&quot;</span><br><span class="line"># skip_symlinks = &quot;false&quot;</span><br><span class="line"># debug_https = &quot;false&quot;</span><br><span class="line"># skip_dotfiles = &quot;false&quot;</span><br><span class="line"># dry_run = &quot;false&quot;</span><br><span class="line"># min_notify_changes = &quot;5&quot;</span><br><span class="line"># monitor_log_frequency = &quot;5&quot;</span><br><span class="line"># monitor_fullscan_frequency = &quot;10&quot;</span><br><span class="line"># sync_root_files = &quot;false&quot;</span><br><span class="line"># classify_as_big_delete = &quot;1000&quot;</span><br><span class="line"># user_agent = &quot;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="sync-dir"><a href="#sync-dir" class="headerlink" title="sync_dir"></a>sync_dir</h3><p><code>sync_dir</code> 指定OneDrive中的文件同步到本地文件的位置 若修改<code>sync_dir</code>需在同步时，在原命令后加<code>--resync</code>，如<code>onedrive --synchronize --resync</code>。</p>
<h3 id="skip-dir"><a href="#skip-dir" class="headerlink" title="skip_dir"></a>skip_dir</h3><p><code>skip_dir</code>同步时跳过本地的某些文件夹。</p>
<h3 id="skip-file"><a href="#skip-file" class="headerlink" title="skip_file"></a>skip_file</h3><p><code>skip_file</code>同步时跳过本地的某些文件 <strong>注意</strong>：修改<code>skip_dir</code>和<code>skip_file</code>都是相对<code>sync_dir</code>而言的，并且修改后同步，要在原命令后加<code>--resync</code>。 具体见<a target="_blank" rel="noopener" href="https://github.com/abraunegg/onedrive/blob/master/docs/USAGE.md">这里</a>。</p>
<h2 id="卸载客户端"><a href="#卸载客户端" class="headerlink" title="卸载客户端"></a>卸载客户端</h2><p>在下载的onedrive目录下执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo make uninstall</span><br><span class="line">rm -rf ~/.config/onedrive</span><br></pre></td></tr></table></figure>
<h2 id="onedrive帮助"><a href="#onedrive帮助" class="headerlink" title="onedrive帮助"></a>onedrive帮助</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">OneDrive - a client for OneDrive Cloud Services</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  onedrive [options] --synchronize</span><br><span class="line">      Do a one time synchronization</span><br><span class="line">  onedrive [options] --monitor</span><br><span class="line">      Monitor filesystem and sync regularly</span><br><span class="line">  onedrive [options] --display-config</span><br><span class="line">      Display the currently used configuration</span><br><span class="line">  onedrive [options] --display-sync-status</span><br><span class="line">      Query OneDrive service and report on pending changes</span><br><span class="line">  onedrive -h  --help</span><br><span class="line">      Show this help screen</span><br><span class="line">  onedrive --version</span><br><span class="line">      Show version</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"></span><br><span class="line">  --auth-files ARG</span><br><span class="line">      Perform authorization via two files passed in as ARG in the format `authUrl:responseUrl`</span><br><span class="line">      The authorization URL is written to the `authUrl`, then onedrive waits for the file `responseUrl`</span><br><span class="line">      to be present, and reads the response from that file.</span><br><span class="line">  --check-for-nomount</span><br><span class="line">      Check for the presence of .nosync in the syncdir root. If found, do not perform sync.</span><br><span class="line">  --check-for-nosync</span><br><span class="line">      Check for the presence of .nosync in each directory. If found, skip directory from sync.</span><br><span class="line">  --confdir ARG</span><br><span class="line">      Set the directory used to store the configuration files</span><br><span class="line">  --create-directory ARG</span><br><span class="line">      Create a directory on OneDrive - no sync will be performed.</span><br><span class="line">  --debug-https</span><br><span class="line">      Debug OneDrive HTTPS communication.</span><br><span class="line">  --destination-directory ARG</span><br><span class="line">      Destination directory for renamed or move on OneDrive - no sync will be performed.</span><br><span class="line">  --disable-notifications</span><br><span class="line">      Do not use desktop notifications in monitor mode.</span><br><span class="line">  --disable-upload-validation</span><br><span class="line">      Disable upload validation when uploading to OneDrive</span><br><span class="line">  --display-config</span><br><span class="line">      Display what options the client will use as currently configured - no sync will be performed.</span><br><span class="line">  --display-sync-status</span><br><span class="line">      Display the sync status of the client - no sync will be performed.</span><br><span class="line">  --download-only</span><br><span class="line">      Only download remote changes</span><br><span class="line">  --dry-run</span><br><span class="line">      Perform a trial sync with no changes made</span><br><span class="line">  --enable-logging</span><br><span class="line">      Enable client activity to a separate log file</span><br><span class="line">  --force</span><br><span class="line">      Force the deletion of data when a &#x27;big delete&#x27; is detected</span><br><span class="line">  --force-http-1.1</span><br><span class="line">      Force the use of HTTP/1.1 for all operations (DEPRECIATED)</span><br><span class="line">  --force-http-2</span><br><span class="line">      Force the use of HTTP/2 for all operations where applicable</span><br><span class="line">  --get-O365-drive-id ARG</span><br><span class="line">      Query and return the Office 365 Drive ID for a given Office 365 SharePoint Shared Library</span><br><span class="line">  --get-file-link ARG</span><br><span class="line">      Display the file link of a synced file</span><br><span class="line">  --help -h</span><br><span class="line">      This help information.</span><br><span class="line">  --local-first</span><br><span class="line">      Synchronize from the local directory source first, before downloading changes from OneDrive.</span><br><span class="line">  --log-dir ARG</span><br><span class="line">      Directory where logging output is saved to, needs to end with a slash.</span><br><span class="line">  --logout</span><br><span class="line">      Logout the current user</span><br><span class="line">  --min-notify-changes ARG</span><br><span class="line">      Minimum number of pending incoming changes necessary to trigger a desktop notification</span><br><span class="line">  --monitor -m</span><br><span class="line">      Keep monitoring for local and remote changes</span><br><span class="line">  --monitor-fullscan-frequency ARG</span><br><span class="line">      Number of sync runs before performing a full local scan of the synced directory</span><br><span class="line">  --monitor-interval ARG</span><br><span class="line">      Number of seconds by which each sync operation is undertaken when idle under monitor mode.</span><br><span class="line">  --monitor-log-frequency ARG</span><br><span class="line">      Frequency of logging in monitor mode</span><br><span class="line">  --no-remote-delete</span><br><span class="line">      Do not delete local file &#x27;deletes&#x27; from OneDrive when using --upload-only</span><br><span class="line">  --print-token</span><br><span class="line">      Print the access token, useful for debugging</span><br><span class="line">  --remove-directory ARG</span><br><span class="line">      Remove a directory on OneDrive - no sync will be performed.</span><br><span class="line">  --resync</span><br><span class="line">      Forget the last saved state, perform a full sync</span><br><span class="line">  --single-directory ARG</span><br><span class="line">      Specify a single local directory within the OneDrive root to sync.</span><br><span class="line">  --skip-dir</span><br><span class="line">      Skip any directories that match this pattern from syncing</span><br><span class="line">  --skip-dot-files</span><br><span class="line">      Skip dot files and folders from syncing</span><br><span class="line">  --skip-file ARG</span><br><span class="line">      Skip any files that match this pattern from syncing</span><br><span class="line">  --skip-size</span><br><span class="line">      Skip new files larger than this size (in MB)</span><br><span class="line">  --skip-symlinks</span><br><span class="line">      Skip syncing of symlinks</span><br><span class="line">  --source-directory ARG</span><br><span class="line">      Source directory to rename or move on OneDrive - no sync will be performed.</span><br><span class="line">  --sync-root-files</span><br><span class="line">      Sync all files in sync_dir root when using sync_list.</span><br><span class="line">  --syncdir ARG</span><br><span class="line">      Specify the local directory used for synchronization to OneDrive</span><br><span class="line">  --synchronize</span><br><span class="line">      Perform a synchronization</span><br><span class="line">  --upload-only</span><br><span class="line">      Only upload to OneDrive, do not sync changes from OneDrive locally</span><br><span class="line">  --user-agent ARG</span><br><span class="line">      Specify a User Agent string to the http client</span><br><span class="line">  --verbose -v+</span><br><span class="line">      Print more details, useful for debugging (repeat for extra debugging)</span><br><span class="line">  --version</span><br><span class="line">      Print the version and exit</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/16/linux-screen-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/16/linux-screen-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">linux screen 命令详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-16 13:31:00" itemprop="dateCreated datePublished" datetime="2020-01-16T13:31:00+08:00">2020-01-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:10:54" itemprop="dateModified" datetime="2022-02-13T14:10:54+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
    <span id="/2020/01/16/linux-screen-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/" class="post-meta-item leancloud_visitors" data-flag-title="linux screen 命令详解" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/16/linux-screen-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/16/linux-screen-命令详解/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参见<a target="_blank" rel="noopener" href="https://blog.csdn.net/xfg0218/article/details/81869313">博客</a></p>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>会话恢复、多会话、会话共享</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">-4            Resolve hostnames only to IPv4 addresses.</span><br><span class="line">-6            Resolve hostnames only to IPv6 addresses.</span><br><span class="line">-a            Force all capabilities into each window&#x27;s termcap.</span><br><span class="line">-A -[rR]     Adapt all windows to the new display width &amp; height.</span><br><span class="line">-c file       Read configuration file instead of &#x27;.screenrc&#x27;.</span><br><span class="line">-d (-r)       Detach the elsewhere running screen (and reattach here).</span><br><span class="line">-dmS name     Start as daemon: Screen session in detached mode.</span><br><span class="line">-D (-r)       Detach and logout remote (and reattach here).</span><br><span class="line">-D -RR        Do whatever is needed to get a screen session.</span><br><span class="line">-e xy         Change command characters.</span><br><span class="line">-f            Flow control on, -fn = off, -fa = auto.</span><br><span class="line">-h lines      Set the size of the scrollback history buffer.</span><br><span class="line">-i            Interrupt output sooner when flow control is on.</span><br><span class="line">-l            Login mode on (update /var/run/utmp), -ln = off.</span><br><span class="line">-ls [match]   or</span><br><span class="line">-list         Do nothing, just list our SockDir [on possible matches].</span><br><span class="line">-L            Turn on output logging.</span><br><span class="line">-m            ignore $STY variable, do create a new screen session.</span><br><span class="line">-O            Choose optimal output rather than exact vt100 emulation.</span><br><span class="line">-p window     Preselect the named window if it exists.</span><br><span class="line">-q            Quiet startup. Exits with non-zero return code if unsuccessful.</span><br><span class="line">-Q            Commands will send the response to the stdout of the querying process.</span><br><span class="line">-r [session]  Reattach to a detached screen process.</span><br><span class="line">-R            Reattach if possible, otherwise start a new session.</span><br><span class="line">-s shell      Shell to execute rather than $SHELL.</span><br><span class="line">-S sockname   Name this session &lt;pid&gt;.sockname instead of &lt;pid&gt;.&lt;tty&gt;.&lt;host&gt;.</span><br><span class="line">-t title      Set title. (window&#x27;s name).</span><br><span class="line">-T term       Use term as $TERM for windows, rather than &quot;screen&quot;.</span><br><span class="line">-U            Tell screen to use UTF-8 encoding.</span><br><span class="line">-v            Print &quot;Screen version 4.01.00devel (GNU) 2-May-06&quot;.</span><br><span class="line">-wipe [match] Do nothing, just clean up SockDir [on possible matches].</span><br><span class="line">-x            Attach to a not detached screen. (Multi display mode).</span><br><span class="line">-X            Execute &lt;cmd&gt; as a screen command in the specified session.</span><br></pre></td></tr></table></figure>
<h2 id="常用screen参数"><a href="#常用screen参数" class="headerlink" title="常用screen参数"></a>常用screen参数</h2><p>screen -S yourname -&gt; 新建一个叫yourname的session screen -ls -&gt; 列出当前所有的session screen -r yourname -&gt; 回到yourname这个session screen -d yourname -&gt; 远程detach某个session screen -d -r yourname -&gt; 结束当前session并回到yourname这个session</p>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><h3 id="安装screen"><a href="#安装screen" class="headerlink" title="安装screen"></a>安装screen</h3><p><code>yum install screen</code></p>
<h3 id="创建新会话"><a href="#创建新会话" class="headerlink" title="创建新会话"></a>创建新会话</h3><p><code>screen -S onwaier</code></p>
<h3 id="显示会话列表"><a href="#显示会话列表" class="headerlink" title="显示会话列表"></a>显示会话列表</h3><p><img src="/images/2020/01/41c572d91420db04e5cae3b024e87a15.png" alt=""></p>
<h3 id="暂停与恢复会话"><a href="#暂停与恢复会话" class="headerlink" title="暂停与恢复会话"></a>暂停与恢复会话</h3><p><code>screen -d 27537</code> 27537会话已变成detached状态 <img src="/images/2020/01/2e78cb20f3650367284f8a0c92963779.png" alt=""> <code>screen -r 27537</code> 27537会话再次变成attached状态 <img src="/images/2020/01/1bb040a4a88cbcea494bead8c33c8e5c.png" alt=""></p>
<h3 id="杀死与清除dead会话"><a href="#杀死与清除dead会话" class="headerlink" title="杀死与清除dead会话"></a>杀死与清除dead会话</h3><p><code>kill -9 27537</code> <img src="/images/2020/01/abb08e8489319630f7e12184b9094a5c.png" alt=""> <code>screen -wipe 27537</code> <img src="/images/2020/01/9399c3881226cf3d8bcd3be79c9c6e55.png" alt=""></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/09/leetcode2019%E7%AC%AC169%E5%9C%BA%E5%91%A8%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/09/leetcode2019%E7%AC%AC169%E5%9C%BA%E5%91%A8%E8%B5%9B/" class="post-title-link" itemprop="url">LeetCode2019第169场周赛</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-09 18:58:16" itemprop="dateCreated datePublished" datetime="2020-01-09T18:58:16+08:00">2020-01-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:08:20" itemprop="dateModified" datetime="2022-02-13T14:08:20+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
        </span>
    </span>

  
    <span id="/2020/01/09/leetcode2019%E7%AC%AC169%E5%9C%BA%E5%91%A8%E8%B5%9B/" class="post-meta-item leancloud_visitors" data-flag-title="LeetCode2019第169场周赛" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/09/leetcode2019%E7%AC%AC169%E5%9C%BA%E5%91%A8%E8%B5%9B/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/09/leetcode2019第169场周赛/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1304-和为零的N个唯一整数"><a href="#1304-和为零的N个唯一整数" class="headerlink" title="1304. 和为零的N个唯一整数"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-n-unique-integers-sum-up-to-zero/">1304. 和为零的N个唯一整数</a></h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>给你一个整数 n，请你返回 任意 一个由 n 个 各不相同 的整数组成的数组，并且这 n 个数相加和为 0 。  示例 1： 输入：n = 5 输出：[-7,-1,1,3,4] 解释：这些数组也是正确的 [-5,-1,1,2,3]，[-3,-1,2,-2,4]。 示例 2： 输入：n = 3 输出：[-1,0,1] 示例 3： 输入：n = 1 输出：[0]  提示： 1 &lt;= n &lt;= 1000</p>
<h2 id="题解1"><a href="#题解1" class="headerlink" title="题解1"></a>题解1</h2><p>产生n个不同的数字和为0的方式有很多种，可以对称产生0左右两边的数。具体 如果$n = 2 <em> m$，则结果为：$-m, -(m - 1), \dots, -1, 1, \dots, m - 1, m$。 如果$n = 2 </em> m + 1$，则结果为：$-m, -(m - 1), \dots, -1, 0，1, \dots, m - 1, m$。</p>
<h2 id="代码1"><a href="#代码1" class="headerlink" title="代码1"></a>代码1</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sumZero</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;res;</span><br><span class="line">        <span class="keyword">if</span>(n &amp; <span class="number">1</span> == <span class="number">1</span>)&#123;</span><br><span class="line">            res.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n &gt;&gt; <span class="number">1</span>; ++i)&#123;</span><br><span class="line">            res.<span class="built_in">push_back</span>(i);</span><br><span class="line">            res.<span class="built_in">push_back</span>(-i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="1305-两棵二叉搜索树中的所有元素"><a href="#1305-两棵二叉搜索树中的所有元素" class="headerlink" title="1305. 两棵二叉搜索树中的所有元素"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/all-elements-in-two-binary-search-trees/">1305. 两棵二叉搜索树中的所有元素</a></h1><h2 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h2><p>给你 root1 和 root2 这两棵二叉搜索树。 请你返回一个列表，其中包含 两棵树 中的所有整数并按 升序 排序。. 示例 1： <img src="/images/2020/01/9930a903b02a23f9c9fb6e1122093fda.png" alt=""> 输入：root1 = [2,1,4], root2 = [1,0,3] 输出：[0,1,1,2,3,4] 示例 2： 输入：root1 = [0,-10,10], root2 = [5,1,7,0,2] 输出：[-10,0,0,1,2,5,7,10] 示例 3： 输入：root1 = [], root2 = [5,1,7,0,2] 输出：[0,1,2,5,7] 示例 4： 输入：root1 = [0,-10,10], root2 = [] 输出：[-10,0,10] 示例 5： <img src="/images/2020/01/060ed4aaa3a6736c111b7224a9663f43.png" alt=""> 输入：root1 = [1,null,8], root2 = [8,1] 输出：[1,1,8,8] 提示： 每棵树最多有 5000 个节点。 每个节点的值在 [-10^5, 10^5] 之间。</p>
<h2 id="题解1-1"><a href="#题解1-1" class="headerlink" title="题解1"></a>题解1</h2><p>对于二叉搜索树，中序遍历可以得到有序的序列。分别对两棵二叉搜索树中序遍历，然后再对结果进行归并排序。 但比赛为了求速度，直接将结果用sort排序。</p>
<h2 id="代码1-1"><a href="#代码1-1" class="headerlink" title="代码1"></a>代码1</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inorder</span><span class="params">(TreeNode* root, vector&lt;<span class="type">int</span>&gt;&amp; res)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">inorder</span>(root-&gt;left, res);</span><br><span class="line">    res.<span class="built_in">push_back</span>(root-&gt;val);</span><br><span class="line">    <span class="built_in">inorder</span>(root-&gt;right, res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">getAllElements</span><span class="params">(TreeNode* root1, TreeNode* root2)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;res1;</span><br><span class="line">        <span class="built_in">inorder</span>(root1, res1);<span class="comment">//中序遍历</span></span><br><span class="line">        <span class="built_in">inorder</span>(root2, res1);<span class="comment">//中序遍历</span></span><br><span class="line">        <span class="built_in">sort</span>(res1.<span class="built_in">begin</span>(), res1.<span class="built_in">end</span>());<span class="comment">//这里可修改为归并排序 </span></span><br><span class="line">        <span class="keyword">return</span> res1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="1306-跳跃游戏-III"><a href="#1306-跳跃游戏-III" class="headerlink" title="1306. 跳跃游戏 III"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/jump-game-iii/">1306. 跳跃游戏 III</a></h1><h2 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h2><p>这里有一个非负整数数组 arr，你最开始位于该数组的起始下标 start 处。当你位于下标 i 处时，你可以跳到 i + arr[i] 或者 i - arr[i]。 请你判断自己是否能够跳到对应元素值为 0 的 任意 下标处。 注意，不管是什么情况下，你都无法跳到数组之外。 示例 1： 输入：arr = [4,2,3,0,3,1,2], start = 5 输出：true 解释： 到达值为 0 的下标 3 有以下可能方案： 下标 5 -&gt; 下标 4 -&gt; 下标 1 -&gt; 下标 3 下标 5 -&gt; 下标 6 -&gt; 下标 4 -&gt; 下标 1 -&gt; 下标 3 示例 2： 输入：arr = [4,2,3,0,3,1,2], start = 0 输出：true 解释： 到达值为 0 的下标 3 有以下可能方案： 下标 0 -&gt; 下标 4 -&gt; 下标 1 -&gt; 下标 3 示例 3 输入：arr = [3,0,2,1,2], start = 2 输出：false 解释：无法到达值为 0 的下标 1 处。 提示： 1 &lt;= arr.length &lt;= 5 * 10^4 0 &lt;= arr[i] &lt; arr.length 0 &lt;= start &lt; arr.length</p>
<h2 id="题解1-2"><a href="#题解1-2" class="headerlink" title="题解1"></a>题解1</h2><p>BFS，判断能否从起始下标到达值为0的下标位置</p>
<h2 id="代码1-2"><a href="#代码1-2" class="headerlink" title="代码1"></a>代码1</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canReach</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr, <span class="type">int</span> start)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;target;</span><br><span class="line">        <span class="type">int</span> len = arr.<span class="built_in">size</span>(), frt;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">false</span>, res = <span class="literal">false</span>;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;<span class="built_in">mark</span>(len, <span class="number">0</span>);</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;<span class="built_in">mark1</span>(len, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; arr.<span class="built_in">size</span>(); ++i)&#123;<span class="comment">//将值为0的数字的下标进行标记</span></span><br><span class="line">            <span class="keyword">if</span>(arr[i] == <span class="number">0</span>)&#123;</span><br><span class="line">                mark[i] = <span class="number">1</span>;</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flag)&#123;<span class="comment">//不存在值为0的数字</span></span><br><span class="line">            res = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//BFS</span></span><br><span class="line">            queue&lt;<span class="type">int</span>&gt;que;</span><br><span class="line">            que.<span class="built_in">push</span>(start);</span><br><span class="line">            mark1[start] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(!que.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                frt = que.<span class="built_in">front</span>();</span><br><span class="line">                que.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">if</span>(mark[frt])&#123;<span class="comment">//移动值为0的位置，直接break</span></span><br><span class="line">                    res = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(frt + arr[frt] &lt; len &amp;&amp; !mark1[frt + arr[frt]])&#123;<span class="comment">//向前移</span></span><br><span class="line">                    que.<span class="built_in">push</span>(frt + arr[frt]);</span><br><span class="line">                    mark1[frt + arr[frt]] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(frt - arr[frt] &gt;= <span class="number">0</span> &amp;&amp; !mark1[frt - arr[frt]])&#123;<span class="comment">//向后移</span></span><br><span class="line">                    que.<span class="built_in">push</span>(frt - arr[frt]);</span><br><span class="line">                    mark1[frt - arr[frt]] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="1307-口算难题"><a href="#1307-口算难题" class="headerlink" title="1307. 口算难题"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/verbal-arithmetic-puzzle/">1307. 口算难题</a></h1><h2 id="题目描述-3"><a href="#题目描述-3" class="headerlink" title="题目描述"></a>题目描述</h2><p>给你一个方程，左边用 words 表示，右边用 result 表示。 你需要根据以下规则检查方程是否可解： 每个字符都会被解码成一位数字（0 - 9）。 每对不同的字符必须映射到不同的数字。 每个 words[i] 和 result 都会被解码成一个没有前导零的数字。 左侧数字之和（words）等于右侧数字（result）。  如果方程可解，返回 True，否则返回 False。 示例 1： 输入：words = [“SEND”,”MORE”], result = “MONEY” 输出：true 解释：映射 ‘S’-&gt; 9, ‘E’-&gt;5, ‘N’-&gt;6, ‘D’-&gt;7, ‘M’-&gt;1, ‘O’-&gt;0, ‘R’-&gt;8, ‘Y’-&gt;’2’ 所以 “SEND” + “MORE” = “MONEY” , 9567 + 1085 = 10652 示例 2： 输入：words = [“SIX”,”SEVEN”,”SEVEN”], result = “TWENTY” 输出：true 解释：映射 ‘S’-&gt; 6, ‘I’-&gt;5, ‘X’-&gt;0, ‘E’-&gt;8, ‘V’-&gt;7, ‘N’-&gt;2, ‘T’-&gt;1, ‘W’-&gt;’3’, ‘Y’-&gt;4 所以 “SIX” + “SEVEN” + “SEVEN” = “TWENTY” , 650 + 68782 + 68782 = 138214 示例 3： 输入：words = [“THIS”,”IS”,”TOO”], result = “FUNNY” 输出：true 示例 4： 输入：words = [“LEET”,”CODE”], result = “POINT” 输出：false 提示： 2 &lt;= words.length &lt;= 5 1 &lt;= words[i].length, results.length &lt;= 7 words[i], result 只含有大写英文字母 表达式中使用的不同字符数最大为 10</p>
<h2 id="题解1-3"><a href="#题解1-3" class="headerlink" title="题解1"></a>题解1</h2><p>因为表达式中使用的不同字符数最大为10，字符的取值0-9（值不能相同）最多为$10!$种情况。思路如下： 首先将不重复的字符统计出来，然后用next_permutation产生不同的取值，判断是否符合情况。 这种暴力方式会超时，因为next_permutation产生取值的时间需要o(n)时间，并且包含重复的情况。</p>
<h2 id="代码1-3"><a href="#代码1-3" class="headerlink" title="代码1"></a>代码1</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//超时</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">deal</span><span class="params">(vector&lt;string&gt;&amp; words, string&amp; result, unordered_map&lt;<span class="type">char</span>, <span class="type">int</span>&gt;&amp; myMap)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; words.<span class="built_in">size</span>(); ++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(words[i].<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; myMap[words[i][<span class="number">0</span>]] == <span class="number">0</span>)&#123;<span class="comment">//前导0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(result.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; myMap[result[<span class="number">0</span>]] == <span class="number">0</span>)&#123;<span class="comment">//前导0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> lSum = <span class="number">0</span>, rSum = <span class="number">0</span>, num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> word:words)&#123;</span><br><span class="line">        num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ch:word)&#123;</span><br><span class="line">            num = num * <span class="number">10</span> + myMap[ch];</span><br><span class="line">        &#125;</span><br><span class="line">        lSum += num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> ch:result)&#123;</span><br><span class="line">        rSum = rSum * <span class="number">10</span> + myMap[ch];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lSum == rSum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSolvable</span><span class="params">(vector&lt;string&gt;&amp; words, string result)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        unordered_map&lt;<span class="type">char</span>, <span class="type">int</span>&gt;myMap;</span><br><span class="line">        string str;</span><br><span class="line">        <span class="type">int</span> flag = <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> arr[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> word:words)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> ch:word)&#123;</span><br><span class="line">                <span class="keyword">if</span>(myMap.<span class="built_in">find</span>(ch) == myMap.<span class="built_in">end</span>())&#123;</span><br><span class="line">                    str.<span class="built_in">push_back</span>(ch);</span><br><span class="line">                    myMap[ch] = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        len = str.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)&#123;</span><br><span class="line">                myMap[str[i]] = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">deal</span>(words, result, myMap))&#123;</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">while</span>(<span class="built_in">next_permutation</span>(arr, arr + <span class="number">10</span>));</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="题解2"><a href="#题解2" class="headerlink" title="题解2"></a>题解2</h2><p>用dfs来代替next_permutation，不会产生重复的情况。加入前导0的标记并将map换成数组。</p>
<h2 id="代码2"><a href="#代码2" class="headerlink" title="代码2"></a>代码2</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt;<span class="built_in">myMap</span>(<span class="number">26</span>, <span class="number">0</span>);</span><br><span class="line">vector&lt;<span class="type">bool</span>&gt;<span class="built_in">mark</span>(<span class="number">26</span>, <span class="number">0</span>);</span><br><span class="line">string str;</span><br><span class="line"><span class="type">bool</span> res = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">deal</span><span class="params">(vector&lt;string&gt;&amp; words, string&amp; result)</span></span>&#123;<span class="comment">//判断相加后是否相等</span></span><br><span class="line">    <span class="type">int</span> lSum = <span class="number">0</span>, rSum = <span class="number">0</span>, num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> word:words)&#123;</span><br><span class="line">        num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ch:word)&#123;</span><br><span class="line">            num = num * <span class="number">10</span> + myMap[ch - <span class="string">&#x27;A&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        lSum += num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> ch:result)&#123;</span><br><span class="line">        rSum = rSum * <span class="number">10</span> + myMap[ch - <span class="string">&#x27;A&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lSum == rSum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(vector&lt;string&gt;&amp; words, string&amp; result, <span class="type">int</span> pos, <span class="type">int</span> used)</span></span>&#123;<span class="comment">//递归暴力</span></span><br><span class="line">    <span class="keyword">if</span>(res)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pos == str.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">deal</span>(words, result))&#123;</span><br><span class="line">            res = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>((mark[str[pos] - <span class="string">&#x27;A&#x27;</span>] &amp;&amp; i == <span class="number">0</span>)  used &gt;&gt; i &amp; <span class="number">1</span>) <span class="keyword">continue</span>;<span class="comment">//前导0或者数字重复</span></span><br><span class="line">        myMap[str[pos] - <span class="string">&#x27;A&#x27;</span>] = i;</span><br><span class="line">        <span class="built_in">dfs</span>(words, result, pos + <span class="number">1</span>, used  <span class="number">1</span> &lt;&lt; i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSolvable</span><span class="params">(vector&lt;string&gt;&amp; words, string result)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        myMap.<span class="built_in">clear</span>();</span><br><span class="line">        str.<span class="built_in">clear</span>();</span><br><span class="line">        res = <span class="literal">false</span>;</span><br><span class="line">        mark.<span class="built_in">assign</span>(<span class="number">26</span>, <span class="number">0</span>);</span><br><span class="line">        myMap.<span class="built_in">assign</span>(<span class="number">26</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> word:words)&#123;<span class="comment">//统计字符的个数</span></span><br><span class="line">            mark[word[<span class="number">0</span>] - <span class="string">&#x27;A&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> ch:word)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!myMap[ch - <span class="string">&#x27;A&#x27;</span>])&#123;</span><br><span class="line">                    str.<span class="built_in">push_back</span>(ch);</span><br><span class="line">                    myMap[ch - <span class="string">&#x27;A&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mark[result[<span class="number">0</span>] - <span class="string">&#x27;A&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ch:result)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!myMap[ch - <span class="string">&#x27;A&#x27;</span>])&#123;</span><br><span class="line">                str.<span class="built_in">push_back</span>(ch);</span><br><span class="line">                myMap[ch - <span class="string">&#x27;A&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        len = str.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">dfs</span>(words, result, <span class="number">0</span>, <span class="number">0</span>); </span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="题解3"><a href="#题解3" class="headerlink" title="题解3"></a>题解3</h2><p>参照<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/verbal-arithmetic-puzzle/solution/he-bing-tong-lei-xiang-dfsc-100-by-aleix/">圈子</a></p>
<h2 id="代码3"><a href="#代码3" class="headerlink" title="代码3"></a>代码3</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">char</span>&gt; h;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; base;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">coe</span><span class="params">(<span class="number">26</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">not_zero</span><span class="params">(<span class="number">26</span>,<span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> pos,<span class="type">int</span> used, <span class="type">int</span> sum)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pos == h.<span class="built_in">size</span>()) <span class="keyword">return</span> sum == <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(used&gt;&gt;i &amp; <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">0</span> &amp;&amp; not_zero[h[pos]-<span class="string">&#x27;A&#x27;</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">dfs</span>(pos+<span class="number">1</span>,used  <span class="number">1</span>&lt;&lt;i, sum+i*coe[h[pos]-<span class="string">&#x27;A&#x27;</span>])) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSolvable</span><span class="params">(vector&lt;string&gt;&amp; words, string result)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        h.<span class="built_in">clear</span>();</span><br><span class="line">        base.<span class="built_in">clear</span>();</span><br><span class="line">        coe.<span class="built_in">assign</span>(<span class="number">26</span>, <span class="number">0</span>);</span><br><span class="line">        not_zero.<span class="built_in">assign</span>(<span class="number">26</span>, <span class="literal">false</span>);</span><br><span class="line">        words.<span class="built_in">push_back</span>(result);</span><br><span class="line">        base.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= <span class="number">8</span> ; i++) base.<span class="built_in">push_back</span>(base.<span class="built_in">back</span>()*<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span> ; j &lt; words.<span class="built_in">size</span>() ; j++) &#123;</span><br><span class="line">            string x = words[j];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; x.<span class="built_in">size</span>() ; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span>) not_zero[x[i]-<span class="string">&#x27;A&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">                h.<span class="built_in">push_back</span>(x[i]);</span><br><span class="line">                <span class="type">int</span> flag = j==words.<span class="built_in">size</span>()<span class="number">-1</span>?<span class="number">-1</span>:<span class="number">1</span>;</span><br><span class="line">                coe[x[i]-<span class="string">&#x27;A&#x27;</span>] += flag * base[x.<span class="built_in">size</span>()<span class="number">-1</span>-i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(h.<span class="built_in">begin</span>(),h.<span class="built_in">end</span>());</span><br><span class="line">        h.<span class="built_in">erase</span>(<span class="built_in">unique</span>(h.<span class="built_in">begin</span>(),h.<span class="built_in">end</span>()),h.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/06/feratt-facial-expression-recognition-with-attention-net%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Onwaier">
      <meta itemprop="description" content="Onwaier的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Onwaier's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/06/feratt-facial-expression-recognition-with-attention-net%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">FERAtt: Facial Expression Recognition with Attention Net阅读笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-06 20:29:25" itemprop="dateCreated datePublished" datetime="2020-01-06T20:29:25+08:00">2020-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-13 14:05:50" itemprop="dateModified" datetime="2022-02-13T14:05:50+08:00">2022-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BA%BA%E8%84%B8%E8%A1%A8%E6%83%85%E8%AF%86%E5%88%AB/" itemprop="url" rel="index"><span itemprop="name">人脸表情识别</span></a>
        </span>
    </span>

  
    <span id="/2020/01/06/feratt-facial-expression-recognition-with-attention-net%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="FERAtt: Facial Expression Recognition with Attention Net阅读笔记" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/01/06/feratt-facial-expression-recognition-with-attention-net%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/06/feratt-facial-expression-recognition-with-attention-net阅读笔记/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h2><p>这是一篇CVPRW2019的论文，作者将Attention机制引入到人脸表情识别中。提出Attention model，并写出了一个合成图片的生成器，模型对噪声有较强的鲁棒性，并在CK+，BU-3DFE数据集上有一定的性能提升。</p>
<h2 id="原文地址和github源码地址"><a href="#原文地址和github源码地址" class="headerlink" title="原文地址和github源码地址"></a>原文地址和github源码地址</h2><p><a target="_blank" rel="noopener" href="http://openaccess.thecvf.com/content_CVPRW_2019/papers/MBCCV/Fernandez_FERAtt_Facial_Expression_Recognition_With_Attention_Net_CVPRW_2019_paper.pdf">原文地址</a> <a target="_blank" rel="noopener" href="https://github.com/pedrodiamel/ferattention">github源码地址</a></p>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<p>Recent developments for the facial expression recognition problem consider processing the entire image regardless of the face crop location within the image. Such developments bring in extraneous artifacts, including noise,which might be harmful for classification as well as incur in unnecessary additional computational cost. This is problematic as the minutiae that characterizes facial expressions can be affected by elements such as hair, jewelry, and other environmental objects not defining the actual face and as part of the image background.</p>
</blockquote>
<p>作者认为现在存在的很多研究关注在整张人脸，带来不必要的计算，并引入了一些噪声可能对识别性能产生影响，引入的一些因素像头发，珠宝等并不能决定表情识别的结果，应该作为图片的背景。</p>
<h2 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h2><p>引入Attention机制，像人类的视觉感知一样，只关注目标区域的处理，与之无关的信息直接丢弃。如图所示。 <img src="/images/2020/01/98f0ed8bc463b9a20b4782c4b6a68fb8.png" alt=""><img src="/images/2020/01/505ffabc6a64bcbd5c26e320570eafad.png" alt=""></p>
<h2 id="Network-architecture"><a href="#Network-architecture" class="headerlink" title="Network architecture"></a>Network architecture</h2><p><img src="/images/2020/01/fdcd31b5324549e3bdefbcd6330fe65d.png" alt=""> 网络结构由4部分组成：注意力模块，特征提取模块，重建模块和分类表示模块。</p>
<h3 id="Attention-Module"><a href="#Attention-Module" class="headerlink" title="Attention Module"></a>Attention Module</h3><p><img src="/images/2020/01/f76e64e1b7af96ed39806180bd5dde21.png" alt=""> Attention模块将传统的人脸检测来用图像分割来代替。用了U-net来对图片进行分割，输出的是人脸的掩模。如图所示 <img src="/images/2020/01/86bcf19e0523e7fe72f5e1d3471112ec.png" alt=""><img src="/images/2020/01/ee75c94c91828d1209e92a61b9664428.png" alt=""></p>
<h3 id="Feature-extration-Module"><a href="#Feature-extration-Module" class="headerlink" title="Feature extration Module"></a>Feature extration Module</h3><blockquote>
<p>Four ResBlocks were used to extract high-dimensional features for image attention and to maintain spatial information; no pooling or strided convolutional layers were used.</p>
</blockquote>
<p>使用4个ResBlocks来提取高维度特征，保留空间信息。如图所示。 <img src="/images/2020/01/86bcf19e0523e7fe72f5e1d3471112ec.png" alt=""><img src="/images/2020/01/822c0cf06bd22a1e5900a56743403fa8.png" alt=""></p>
<h3 id="Reconstruction-Module"><a href="#Reconstruction-Module" class="headerlink" title="Reconstruction Module"></a>Reconstruction Module</h3><blockquote>
<p>The reconstruction layer adjusts the attention map to create an enhanced input to the representation module. This module has two convolutional layers, a Relu layer, and an Average Pooling layer which, by design choice, resizes the input image of 128 × 128 to 32 × 32.</p>
</blockquote>
<p><img src="/images/2020/01/f92f5b8b65b3e763a49f6851932497e0.png" alt=""></p>
<h3 id="Representation-and-classification-module"><a href="#Representation-and-classification-module" class="headerlink" title="Representation and classification module"></a>Representation and classification module</h3><p><img src="/images/2020/01/e50c646b0345a85f896b26abe0d35d53.png" alt=""> the network function, builds a representation for a sample image $x \\in R^D$ 主要是建立一个网络，对图片进行再表示，它的分类结果要与原图的分类结果足够接近。 <img src="/images/2020/01/78f82671a69914be48da83ffecfbb42e.png" alt=""> 详细过程参照论文，比较复杂。</p>
<h3 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h3><p><img src="/images/2020/01/6b39eaeebf9d845f73242cdb60004a80.png" alt=""></p>
<h2 id="expriments"><a href="#expriments" class="headerlink" title="expriments"></a>expriments</h2><p>实验部分主要进行Rep模块的对照实验，数据集上的性能比较及算法对噪声的鲁棒性实验。</p>
<h3 id="Datasets"><a href="#Datasets" class="headerlink" title="Datasets"></a>Datasets</h3><blockquote>
<p>Our image renderer R creates a synthetic larger dataset using real face datasets by making background changes and geometric transformations of face images.</p>
</blockquote>
<p>将真实的人脸数据背景进行更换，然后再对人脸图片进行几何变换得到合成数据集。具体过程如图所示。 <img src="/images/2020/01/4dc600a7167dd01e6dc50a7f50030a47.png" alt=""> 使用的数据集有CK+、BU-3DFE、COCO dataset.其中COCO dataset 用作背景图。最后合成的数据集部分如图所示。 <img src="/images/2020/01/129c6e7ef5e4c4a5e564afc3ce255b20.png" alt=""></p>
<h3 id="Expression-recognition-results"><a href="#Expression-recognition-results" class="headerlink" title="Expression recognition results"></a>Expression recognition results</h3><p><img src="/images/2020/01/3d26de5c4ae9e4adf798e7906e823288.png" alt=""> Baseline为PreActResNet18，将其与FERAtt+Cls 和FERAtt + Rep + Cls两种方法进行性能比较，发现再表示对性能的提升有明显的效果。 <img src="/images/2020/01/2effcfe6a06fe696e4ba74dcc1cfa929.png" alt=""> <img src="/images/2020/01/28bdc6ed1023a7ad8320ca781d4fcf3c.png" alt=""></p>
<h3 id="Rebustness-to-noise"><a href="#Rebustness-to-noise" class="headerlink" title="Rebustness to noise"></a>Rebustness to noise</h3><p><img src="/images/2020/01/ca160a0a38b6391f62903167d8ac154b.png" alt=""> <img src="/images/2020/01/0645fc08ae449ba1ad4afe6bca0fb918.png" alt=""><img src="/images/2020/01/94cff341025800dc28d02de14269eba8.png" alt=""> FERAtt + Rep + Cls算法对噪声的鲁棒性较好，在$\\sigma = 0 - 0.10$对于识别性能几乎无影响，继续增大$\\sigma$的值时，它的识别的精度也一直处于其它算法之上。</p>
<h2 id="Contribution"><a href="#Contribution" class="headerlink" title="Contribution"></a>Contribution</h2><ol>
<li>Attention model</li>
<li>A generator of synthetic images</li>
<li>Gaussian Manifold Loss</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Onwaier</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"gh8MGlPldauVJHzSrVU7V7K2-gzGzoHsz","app_key":"6PhJuVxYccEhTAXWI26qbzpG","server_url":null,"security":true}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"onwaier-blog","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
